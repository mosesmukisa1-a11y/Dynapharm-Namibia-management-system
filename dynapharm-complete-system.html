                if (evt?.stopPropagation) evt.stopPropagation();

                // Make sure the stock portal is visible before switching tabs
                if (typeof showTab === 'function') {
                    showTab('stock');
                }

                const stockAuth = document.getElementById('stockAuth');
                const stockContent = document.getElementById('stockContent');
                if (stockContent && stockContent.style.display === 'none') {
                    stockContent.style.display = 'block';
                }
                if (stockAuth && stockAuth.style.display !== 'none' && stockContent) {
                    stockAuth.style.display = 'none';
                }
