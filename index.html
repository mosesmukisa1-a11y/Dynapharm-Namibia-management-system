<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Dynapharm Namibia - Health & Wellness Products</title>
    <link rel="icon" href="./favicon.ico">
    <meta name="description" content="Dynapharm Namibia - Your trusted health and wellness partner. Shop premium health products and book appointments.">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#c41e3a">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --brand-color: #b71c1c;
            --brand-dark: #7f0000;
            --text-dark: #1f2a37;
            --text-light: #64748b;
            --bg-light: #fdf2f3;
            --white: #ffffff;
            --border: #f1f5f9;
            --soft-border: #f8d7da;
            --accent-gold: #fbbf24;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            color: var(--text-dark);
            background: #ffffff;
            line-height: 1.6;
        }

        .top-bar {
            background: var(--brand-color);
            color: var(--white);
            padding: 6px 0;
            font-size: 0.85rem;
        }

        .top-bar .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            padding: 0 20px;
        }

        .top-bar ul {
            display: flex;
            gap: 18px;
            list-style: none;
            margin: 0;
            padding: 0;
            align-items: center;
        }

        .top-bar li {
            letter-spacing: 0.08em;
            text-transform: uppercase;
        }

        .top-bar a {
            color: var(--white);
            text-decoration: none;
        }

        .top-bar a:hover {
            text-decoration: underline;
        }

        body.modal-open {
            overflow: hidden;
        }

        /* Navigation Bar */
        .navbar {
            background: linear-gradient(180deg, rgba(183, 28, 28, 0.08) 0%, rgba(255,255,255,1) 60%);
            box-shadow: 0 8px 20px rgba(183, 28, 28, 0.08);
            position: sticky;
            top: 0;
            z-index: 1000;
            padding: 1rem 0;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--brand-color);
            text-decoration: none;
        }

        .logo img {
            height: 40px;
            width: auto;
        }

        .nav-links {
            display: flex;
            gap: 30px;
            align-items: center;
            list-style: none;
        }

        .nav-links a {
            color: var(--text-dark);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
            cursor: pointer;
        }

        .nav-links a:hover {
            color: var(--brand-dark);
        }

        .nav-links .btn-login {
            background: var(--brand-color);
            color: var(--white);
            padding: 10px 24px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }

        .nav-links .btn-login:hover {
            background: var(--brand-dark);
        }

        /* Account Menu */
        .nav-links .account-nav {
            position: relative;
            display: none;
        }

        .account-button {
            display: flex;
            align-items: center;
            gap: 12px;
            border: none;
            padding: 8px 18px;
            border-radius: 999px;
            background: var(--white);
            box-shadow: 0 10px 30px rgba(15, 23, 42, 0.12);
            cursor: pointer;
            transition: transform 0.25s ease, box-shadow 0.25s ease;
            font-weight: 600;
            color: var(--text-dark);
        }

        .account-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 16px 36px rgba(15, 23, 42, 0.16);
        }

        .account-initials {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--brand-color), var(--brand-dark));
            color: white;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .account-initials.large {
            width: 52px;
            height: 52px;
            font-size: 1.15rem;
        }

        .account-name-wrap {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            line-height: 1.15;
        }

        .account-label {
            font-size: 0.72rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-light);
        }

        .account-name {
            font-size: 0.95rem;
            font-weight: 700;
            color: var(--text-dark);
        }

        .account-chevron {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-left: 2px;
        }

        .account-menu {
            position: absolute;
            top: calc(100% + 14px);
            right: 0;
            width: 280px;
            background: var(--white);
            border-radius: 18px;
            box-shadow: 0 30px 70px rgba(15, 23, 42, 0.22);
            padding: 20px;
            display: none;
            flex-direction: column;
            gap: 18px;
            z-index: 2200;
        }

        .account-menu.active {
            display: flex;
        }

        .account-menu::before {
            content: '';
            position: absolute;
            top: -10px;
            right: 36px;
            width: 20px;
            height: 20px;
            background: var(--white);
            transform: rotate(45deg);
            box-shadow: -5px -5px 15px rgba(15, 23, 42, 0.08);
        }

        .account-menu-header {
            display: flex;
            align-items: center;
            gap: 14px;
            position: relative;
            z-index: 1;
        }

        .account-menu-name {
            font-weight: 700;
            color: var(--text-dark);
            font-size: 1.05rem;
        }

        .account-menu-role {
            color: var(--brand-color);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .account-menu-branch {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 4px;
        }

        .account-menu-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            position: relative;
            z-index: 1;
        }

        .account-menu-primary,
        .account-menu-secondary {
            width: 100%;
            border-radius: 12px;
            padding: 12px 16px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .account-menu-primary {
            background: linear-gradient(135deg, var(--brand-color), var(--brand-dark));
            color: white;
            box-shadow: 0 18px 30px rgba(196, 30, 58, 0.28);
        }

        .account-menu-secondary {
            background: rgba(100, 116, 139, 0.1);
            color: var(--text-dark);
        }

        .account-menu-primary:hover,
        .account-menu-secondary:hover {
            transform: translateY(-1px);
            box-shadow: 0 14px 30px rgba(15, 23, 42, 0.16);
        }

        .nav-action {
            margin-left: 10px;
        }

        /* Hero Auth States */
        .hero[data-auth-state="signed-in"] {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 55%, #312e81 100%);
        }

        .hero[data-auth-state="signed-in"] .hero-badge {
            background: rgba(255, 255, 255, 0.18);
            border-color: rgba(255, 255, 255, 0.35);
        }

        .hero[data-auth-state="signed-in"] .btn-hero-primary {
            background: linear-gradient(135deg, #38bdf8, #0ea5e9);
            color: white;
        }

        .hero[data-auth-state="signed-in"] .btn-hero-secondary {
            border-color: rgba(255, 255, 255, 0.8);
            color: white;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 40px;
            right: 40px;
            background: var(--brand-color);
            color: white;
            padding: 16px 22px;
            border-radius: 14px;
            box-shadow: 0 25px 55px rgba(196, 30, 58, 0.35);
            opacity: 0;
            pointer-events: none;
            transform: translateY(20px);
            transition: opacity 0.3s ease, transform 0.3s ease;
            font-weight: 600;
            z-index: 4000;
            min-width: 220px;
            text-align: center;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.info {
            background: var(--text-dark);
            box-shadow: 0 25px 55px rgba(15, 23, 42, 0.35);
        }

        .toast.success {
            background: linear-gradient(135deg, #16a34a, #15803d);
            box-shadow: 0 25px 55px rgba(22, 163, 74, 0.35);
        }

        .toast.error {
            background: #dc2626;
            box-shadow: 0 25px 55px rgba(220, 38, 38, 0.35);
        }

        /* Hero Section - Modern Design */
        .hero {
            position: relative;
            min-height: 80vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: linear-gradient(135deg, #fff5f5 0%, #ffe6e8 45%, #ffffff 100%);
            color: var(--text-dark);
        }

        .hero-background {
            position: absolute;
            inset: 0;
        }

        .hero-gradient {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 25% 50%, rgba(183, 28, 28, 0.18) 0%, transparent 60%);
            animation: pulse 6s ease-in-out infinite;
        }

        .hero-content {
            position: relative;
            z-index: 2;
            max-width: 1200px;
            padding: 80px 20px 60px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 60px;
            align-items: center;
        }

        .hero-copy {
            display: flex;
            flex-direction: column;
            gap: 22px;
            text-align: left;
        }

        .hero-visual {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hero-visual::before {
            content: '';
            position: absolute;
            width: 340px;
            height: 340px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(183, 28, 28, 0.14) 0%, rgba(183, 28, 28, 0) 70%);
            z-index: 1;
        }

        .hero-visual img {
            position: relative;
            z-index: 2;
            max-width: 320px;
            width: 100%;
            border-radius: 28px;
            box-shadow: 0 24px 55px rgba(183, 28, 28, 0.18);
        }

        .hero-card {
            position: relative;
            z-index: 2;
            background: var(--white);
            border-radius: 28px;
            padding: 36px 32px;
            box-shadow: 0 26px 55px rgba(15, 23, 42, 0.12);
            border: 1px solid var(--soft-border);
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 340px;
        }

        .hero-card-header {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .hero-card-logo {
            width: 64px;
            height: 64px;
            border-radius: 18px;
            background: linear-gradient(135deg, rgba(183, 28, 28, 0.12), rgba(183, 28, 28, 0.25));
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px;
        }

        .hero-card-logo img {
            width: 100%;
            height: auto;
        }

        .hero-card h4 {
            margin: 0;
            font-size: 1.2rem;
            color: var(--brand-dark);
        }

        .hero-card p {
            margin: 0;
            color: var(--text-light);
            font-size: 0.95rem;
        }

        .hero-card-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: grid;
            gap: 12px;
        }

        .hero-card-list li {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .hero-card-list li span {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 12px;
            background: rgba(183, 28, 28, 0.1);
            color: var(--brand-dark);
            font-size: 1rem;
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: rgba(183, 28, 28, 0.12);
            border: 1px solid var(--soft-border);
            padding: 8px 18px;
            border-radius: 999px;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--brand-dark);
            margin-bottom: 10px;
            animation: fadeInUp 0.8s ease-out;
        }

        .hero h1 {
            font-size: clamp(2.5rem, 5vw, 4.5rem);
            font-weight: 800;
            line-height: 1.2;
            margin-bottom: 24px;
            animation: fadeInUp 0.8s ease-out 0.2s both;
        }

        .gradient-text {
            background: linear-gradient(135deg, #b71c1c, #f59e0b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: clamp(1.1rem, 2vw, 1.4rem);
            opacity: 0.9;
            margin-bottom: 32px;
            line-height: 1.8;
            animation: fadeInUp 0.8s ease-out 0.4s both;
            color: var(--text-light);
        }

        .hero-cta {
            display: flex;
            gap: 20px;
            justify-content: flex-start;
            flex-wrap: wrap;
            margin-bottom: 50px;
            animation: fadeInUp 0.8s ease-out 0.6s both;
        }

        .btn-hero-primary {
            background: linear-gradient(135deg, var(--brand-color), var(--brand-dark));
            color: var(--white);
            padding: 16px 34px;
            border-radius: 999px;
            font-size: 1.05rem;
            font-weight: 700;
            border: none;
            cursor: pointer;
            box-shadow: 0 16px 30px rgba(183, 28, 28, 0.25);
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-hero-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 38px rgba(183, 28, 28, 0.28);
        }

        .btn-hero-secondary {
            background: transparent;
            color: var(--brand-dark);
            padding: 16px 32px;
            border-radius: 999px;
            font-size: 1.05rem;
            font-weight: 700;
            border: 2px solid var(--brand-dark);
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-hero-secondary:hover {
            background: var(--brand-dark);
            color: var(--white);
            transform: translateY(-2px);
        }

        .hero-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 24px;
            margin-top: 30px;
            background: var(--white);
            padding: 26px 30px;
            border-radius: 24px;
            box-shadow: 0 18px 45px rgba(15, 23, 42, 0.08);
            animation: fadeInUp 0.8s ease-out 0.8s both;
        }

        .stat-item {
            text-align: left;
            border-left: 4px solid rgba(183, 28, 28, 0.25);
            padding-left: 18px;
        }

        .stat-number {
            font-size: 2.3rem;
            font-weight: 800;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--brand-dark), var(--accent-gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.15; }
            50% { opacity: 0.25; }
        }

        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }

        /* Shop Categories Section */
        .categories-section {
            padding: 80px 20px 60px;
            background: linear-gradient(180deg, #fff 0%, #fff7f7 100%);
        }

        .categories-intro {
            max-width: 1100px;
            margin: 0 auto 45px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 40px;
            align-items: center;
        }

        .categories-intro p {
            color: var(--text-light);
            font-size: 1.05rem;
            line-height: 1.8;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 22px;
            max-width: 1100px;
            margin: 0 auto;
        }

        .category-card {
            background: var(--white);
            border: 1px solid rgba(183, 28, 28, 0.12);
            border-radius: 18px;
            padding: 26px 24px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            transition: transform 0.25s ease, box-shadow 0.25s ease, border-color 0.25s ease;
            box-shadow: 0 12px 24px rgba(15, 23, 42, 0.06);
        }

        .category-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 22px 40px rgba(15, 23, 42, 0.08);
            border-color: rgba(183, 28, 28, 0.35);
        }

        .category-eyebrow {
            font-size: 0.78rem;
            letter-spacing: 0.18em;
            text-transform: uppercase;
            color: rgba(183, 28, 28, 0.75);
        }

        .category-label {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-dark);
        }

        .category-desc {
            color: var(--text-light);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        /* Features Showcase Section */
        .features-section {
            padding: 80px 20px 90px;
            background: var(--white);
            border-top: 1px solid rgba(183, 28, 28, 0.08);
        }

        .section-header-modern {
            text-align: center;
            margin-bottom: 60px;
        }

        .section-header-modern h2 {
            font-size: clamp(2rem, 4vw, 2.8rem);
            font-weight: 800;
            color: var(--text-dark);
            margin-bottom: 16px;
        }

        .section-header-modern p {
            font-size: 1.2rem;
            color: var(--text-light);
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 24px;
            max-width: 1100px;
            margin: 0 auto;
        }

        .feature-card {
            background: linear-gradient(180deg, rgba(183, 28, 28, 0.08) 0%, rgba(255,255,255,1) 55%);
            padding: 32px 28px;
            border-radius: 20px;
            text-align: left;
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            border: 1px solid rgba(183, 28, 28, 0.1);
            box-shadow: 0 18px 35px rgba(15, 23, 42, 0.08);
        }

        .feature-card:hover {
            transform: translateY(-8px);
            border-color: rgba(183, 28, 28, 0.35);
            box-shadow: 0 28px 44px rgba(183, 28, 28, 0.16);
        }

        .feature-icon {
            font-size: 2.2rem;
            margin-bottom: 16px;
            width: 56px;
            height: 56px;
            border-radius: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: rgba(183, 28, 28, 0.12);
            color: var(--brand-dark);
        }

        .feature-card h3 {
            font-size: 1.35rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .feature-card p {
            color: rgba(15, 23, 42, 0.62);
            line-height: 1.7;
            margin-bottom: 20px;
        }

        .feature-link {
            color: var(--brand-dark);
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .feature-link:hover {
            color: var(--brand-dark);
            transform: translateX(5px);
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Modern Testimonials Styling */
        .testimonial-card-modern {
            background: var(--white);
            border: 2px solid var(--brand-color);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(196, 30, 58, 0.15);
            position: relative;
            transition: all 0.3s ease;
        }

        .testimonial-card-modern:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(196, 30, 58, 0.25);
        }

        .testimonial-icon-bg {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 3rem;
            opacity: 0.1;
        }

        .testimonial-header-modern {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .testimonial-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--brand-color), var(--brand-dark));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.5rem;
        }

        .testimonial-info-modern h4 {
            margin: 0;
            color: var(--text-dark);
            font-size: 1.1rem;
        }

        .testimonial-info-modern p {
            margin: 5px 0 0;
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .testimonial-text-modern {
            color: var(--text-dark);
            line-height: 1.8;
            font-style: italic;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        .testimonial-rating-modern {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--brand-color);
            font-size: 0.9rem;
        }

        .testimonial-date-modern {
            margin-left: auto;
            color: var(--text-light);
            font-size: 0.85rem;
        }

        /* Shop Section */
        .shop-section {
            background: var(--white);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }

        .section-header h2 {
            color: var(--brand-color);
            font-size: 1.8rem;
        }

        .search-bar {
            width: 100%;
            max-width: 400px;
            padding: 12px 20px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 20px;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .product-card {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: var(--bg-light);
        }

        .product-info {
            padding: 15px;
        }

        .product-name {
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 8px;
            color: var(--text-dark);
        }

        .product-price {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--brand-color);
            margin-top: 10px;
        }

        /* About Us Section */
        .about-section {
            background: transparent;
            border-radius: 0;
            padding: 0;
            margin: 60px auto;
            max-width: 1100px;
            display: none;
        }

        .about-section.active {
            display: block;
        }

        .about-section a {
            color: var(--brand-dark);
            text-decoration: none;
            font-weight: 600;
        }

        .about-section a:hover {
            text-decoration: underline;
        }

        .info-panels {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 24px;
            margin-top: 30px;
        }

        .info-card {
            background: var(--white);
            border-radius: 18px;
            padding: 28px 26px;
            box-shadow: 0 18px 35px rgba(15, 23, 42, 0.08);
            border: 1px solid rgba(183, 28, 28, 0.1);
        }

        .info-card h3 {
            margin-top: 0;
            margin-bottom: 16px;
            font-size: 1.2rem;
            color: var(--brand-dark);
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .info-card ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: grid;
            gap: 12px;
        }

        .info-card li {
            color: var(--text-light);
            line-height: 1.7;
        }

        .info-card li strong {
            color: var(--text-dark);
        }

        footer.site-footer {
            background: linear-gradient(180deg, #fff 0%, #ffe6ea 100%);
            padding: 50px 20px 30px;
            margin-top: 80px;
            border-top: 1px solid rgba(183, 28, 28, 0.12);
        }

        .footer-inner {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
            gap: 30px;
        }

        .footer-inner h4 {
            margin-bottom: 16px;
            color: var(--brand-dark);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-size: 0.95rem;
        }

        .footer-inner ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: grid;
            gap: 12px;
            color: var(--text-light);
            font-size: 0.95rem;
        }

        .footer-inner li strong {
            color: var(--text-dark);
        }

        .footer-inner a {
            color: var(--brand-dark);
            text-decoration: none;
        }

        .footer-inner a:hover {
            text-decoration: underline;
        }

        .footer-bottom {
            max-width: 1200px;
            margin: 30px auto 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 12px;
            font-size: 0.85rem;
            color: rgba(15, 23, 42, 0.6);
        }

        .footer-social {
            display: flex;
            gap: 14px;
            align-items: center;
        }

        .footer-social a {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 34px;
            height: 34px;
            border-radius: 50%;
            background: rgba(183, 28, 28, 0.12);
            color: var(--brand-dark);
            text-decoration: none;
            font-size: 1rem;
        }

        .footer-social a:hover {
            background: var(--brand-dark);
            color: var(--white);
        }

        /* Login/Register Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            border-radius: 12px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 35px 80px rgba(15, 23, 42, 0.18);
        }

        .modal-content.auth-modal {
            padding: 48px 42px;
            max-width: 560px;
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.97), rgba(246, 248, 251, 0.95));
            border: 1px solid rgba(226, 232, 240, 0.7);
            backdrop-filter: blur(10px);
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-light);
        }

        .modal-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 30px;
            background: rgba(15, 23, 42, 0.05);
            padding: 6px;
            border-radius: 12px;
        }

        .modal-tab {
            flex: 1;
            padding: 12px 14px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-light);
            border-radius: 10px;
            transition: all 0.25s ease;
        }

        .modal-tab.active {
            background: var(--white);
            color: var(--brand-color);
            box-shadow: 0 10px 20px rgba(196, 30, 58, 0.12);
        }

        .modal-form {
            display: none;
            margin-top: 20px;
        }

        .modal-form.active {
            display: block;
        }

        .auth-footnote {
            margin-top: 16px;
            font-size: 0.85rem;
            color: var(--text-light);
            text-align: center;
            line-height: 1.5;
        }

        .auth-card {
            background: rgba(15, 23, 42, 0.05);
            border-radius: 14px;
            padding: 20px;
            border: 1px solid rgba(148, 163, 184, 0.22);
            margin-top: 18px;
        }

        .auth-card.warning {
            background: #fff8e6;
            border-color: #facc15;
            color: #92400e;
        }

        .auth-card + .auth-card {
            margin-top: 12px;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 28px;
        }

        .auth-pill {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 18px;
            border-radius: 999px;
            background: rgba(196, 30, 58, 0.15);
            color: var(--brand-dark);
            font-weight: 600;
            font-size: 0.85rem;
            letter-spacing: 0.03em;
        }

        .auth-header h2 {
            margin-top: 16px;
            font-size: 1.9rem;
            color: var(--text-dark);
        }

        .auth-header p {
            color: var(--text-light);
            margin-top: 12px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--brand-color);
        }

        .btn-submit {
            width: 100%;
            padding: 14px;
            background: var(--brand-color);
            color: var(--white);
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn-submit:hover {
            background: var(--brand-dark);
        }

        .error-message {
            color: #dc2626;
            font-size: 0.9rem;
            margin-top: 8px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .success-message {
            color: #15803d;
            font-size: 0.9rem;
            margin-top: 10px;
            display: none;
        }

        .note {
            background: #fffbeb;
            border: 1px solid #fde68a;
            color: #92400e;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .note.hidden {
            display: none;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .top-bar .container {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .top-bar ul {
                flex-wrap: wrap;
            }

            .nav-links {
                gap: 15px;
            }

            .nav-links a {
                font-size: 0.9rem;
            }

            .account-button {
                padding: 6px 12px;
                gap: 8px;
            }

            .account-name-wrap {
                display: none;
            }

            .hero h1 {
                font-size: 2rem;
            }

            .hero-content {
                grid-template-columns: 1fr;
                gap: 40px;
                padding: 60px 20px 50px;
            }

            .hero-cta {
                justify-content: center;
            }

            .hero-stats {
                padding: 20px;
            }

            .hero-card {
                max-width: 100%;
            }

            .categories-intro {
                grid-template-columns: 1fr;
            }

            .categories-grid {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }

            .footer-inner {
                grid-template-columns: 1fr;
            }

            .footer-bottom {
                flex-direction: column;
                align-items: flex-start;
            }

            .modal-content.auth-modal {
                padding: 36px 24px;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 15px;
            }

            .modal-content {
                padding: 30px 20px;
            }
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-light);
        }

        .spinner {
            border: 4px solid var(--border);
            border-top-color: var(--brand-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
  </head>
  <body>
    <div class="top-bar">
        <div class="container">
            <ul>
                <li>Distributor Login</li>
                <li>MLM</li>
                <li>LRP</li>
            </ul>
            <ul>
                <li><a href="tel:+26461300877">üìû 061-300877</a></li>
                <li><a href="mailto:info@dynapharmnamibia.com">‚úâÔ∏è info@dynapharmnamibia.com</a></li>
            </ul>
        </div>
    </div>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="#" class="logo" onclick="showSection('shop'); return false;">
                <img src="./assets/dynapharm-logo.png" alt="Dynapharm Logo" onerror="this.style.display='none'">
                <span>Dynapharm Namibia</span>
            </a>
            <ul class="nav-links">
                <li><a href="#" onclick="showSection('shop'); return false;">Home</a></li>
                <li><a href="#" onclick="showDistributorTab('shop'); return false;">Guest Portal</a></li>
                <li><a href="#" onclick="showSection('about'); return false;">About Us</a></li>
                <li><a href="#" onclick="showDistributorTab('media'); return false;">Media</a></li>
                <li id="loginNavItem" class="nav-action"><button class="btn-login" id="openAuthModalButton" onclick="openLoginModal()">Sign In</button></li>
                <li id="accountNavItem" class="account-nav">
                    <button class="account-button" id="accountButton" onclick="toggleAccountMenu(event)">
                        <span class="account-initials" id="accountInitials">DN</span>
                        <span class="account-name-wrap">
                            <span class="account-label">Signed in</span>
                            <span class="account-name" id="accountName">Dynapharm</span>
                        </span>
                        <span class="account-chevron">‚ñæ</span>
                    </button>
                    <div class="account-menu" id="accountMenu">
                        <div class="account-menu-header">
                            <div class="account-initials large" id="accountMenuInitials">DN</div>
                            <div>
                                <div class="account-menu-name" id="accountMenuName">Dynapharm User</div>
                                <div class="account-menu-role" id="accountMenuRole">Consultant</div>
                                <div class="account-menu-branch" id="accountMenuBranch"></div>
                            </div>
                        </div>
                        <div class="account-menu-actions">
                            <button type="button" class="account-menu-primary" onclick="navigateToRolePortal()">Enter my portal</button>
                            <button type="button" class="account-menu-secondary" onclick="logout()">Sign out</button>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero" data-auth-state="signed-out">
        <div class="hero-background">
            <div class="hero-gradient"></div>
        </div>
        <div class="hero-content">
            <div class="hero-copy">
                <div class="hero-badge" id="heroBadge">üè• Trusted Health Partner Since 2010</div>
                <h1>
                    Transform Your Health with<br>
                    <span class="gradient-text" id="heroTitleHighlight">Natural Solutions</span>
                </h1>
                <p id="heroSubtitle">Premium health products, expert consultations, and comprehensive wellness services designed to help you live your healthiest life.</p>
                <div class="hero-cta">
                    <button class="btn-hero-primary" id="heroPrimaryAction" onclick="showDistributorTab('shop')">üõí Shop Products</button>
                    <button class="btn-hero-secondary" id="heroSecondaryAction" onclick="showDistributorTab('checkup')">üè• Book Consultation</button>
                </div>
                <div class="hero-stats">
                    <div class="stat-item">
                        <div class="stat-number" id="statCustomers">10,000+</div>
                        <div class="stat-label">Happy Customers</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="statProducts">85+</div>
                        <div class="stat-label">Premium Products</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="statBranches">5+</div>
                        <div class="stat-label">Branch Locations</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="statSupport">24/7</div>
                        <div class="stat-label">Support Available</div>
                    </div>
                </div>
            </div>
            <div class="hero-visual" aria-hidden="true">
                <div class="hero-card">
                    <div class="hero-card-header">
                        <div class="hero-card-logo">
                            <img src="./assets/dynapharm-logo.png" alt="Dynapharm Logo" onerror="this.style.display='none'">
                        </div>
                        <div>
                            <h4>Premium Wellness</h4>
                            <p>Trusted by families across Namibia</p>
                        </div>
                    </div>
                    <ul class="hero-card-list">
                        <li><span>üåø</span>Cleansing & Detoxifying</li>
                        <li><span>üíä</span>Nutritional Supplements</li>
                        <li><span>üõ°Ô∏è</span>Immune Booster</li>
                        <li><span>‚òï</span>Power Coffee</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- Shop by Categories Section -->
    <section class="categories-section">
        <div class="categories-intro">
            <div>
                <h2 style="font-size: clamp(2rem, 4vw, 2.6rem); margin-bottom: 12px; color: var(--text-dark); font-weight: 800;">Shop by Categories</h2>
                <p>Discover the full Dynapharm range inspired by our head office experience. Explore targeted wellness collections designed to cleanse, protect, and energize your body every day.</p>
            </div>
            <div style="background: var(--white); border-radius: 20px; padding: 24px 26px; box-shadow: 0 18px 35px rgba(15, 23, 42, 0.08); border: 1px solid rgba(183, 28, 28, 0.1);">
                <p style="margin: 0; font-weight: 600; color: var(--brand-dark); text-transform: uppercase; letter-spacing: 0.12em;">Natural Wellness Solutions</p>
                <p style="margin-top: 12px; color: var(--text-light); line-height: 1.7;">Your trusted source for holistic health essentials backed by decades of Dynapharm quality.</p>
            </div>
        </div>
        <div class="categories-grid">
            <div class="category-card">
                <span class="category-eyebrow">Cleansing & Detoxifying</span>
                <div class="category-label">Remove toxins and harmful substances</div>
                <p class="category-desc">Support your body‚Äôs natural detox pathways with gentle, effective herbal blends.</p>
            </div>
            <div class="category-card">
                <span class="category-eyebrow">Nutritional Supplements</span>
                <div class="category-label">Safeguard against diet deficiencies</div>
                <p class="category-desc">Fill nutritional gaps with essential vitamins, minerals, and antioxidants.</p>
            </div>
            <div class="category-card">
                <span class="category-eyebrow">Immune Booster</span>
                <div class="category-label">Nutrients & herbs to fight infection</div>
                <p class="category-desc">Strengthen everyday immunity with proven plant-based protectors.</p>
            </div>
            <div class="category-card">
                <span class="category-eyebrow">Mental / Physical / Sexual Health</span>
                <div class="category-label">Essential support for peak vitality</div>
                <p class="category-desc">Balance mind and body with targeted formulations for total wellbeing.</p>
            </div>
            <div class="category-card">
                <span class="category-eyebrow">Diet & Weight Management</span>
                <div class="category-label">Get more from your nutrition goals</div>
                <p class="category-desc">Boost metabolism and maintain healthy weight with synergistic blends.</p>
            </div>
            <div class="category-card">
                <span class="category-eyebrow">Natural Relief</span>
                <div class="category-label">Gentle comfort without side effects</div>
                <p class="category-desc">Soothe aches and everyday discomfort using nature-first remedies.</p>
            </div>
            <div class="category-card">
                <span class="category-eyebrow">Power Coffee</span>
                <div class="category-label">Not just coffee‚Ä¶ it‚Äôs Power Coffee!</div>
                <p class="category-desc">Energize your day with our signature performance coffee infusion.</p>
            </div>
            <div class="category-card">
                <span class="category-eyebrow">Personal Care / Household</span>
                <div class="category-label">Natural care for home & body</div>
                <p class="category-desc">Nourish skin and spaces with botanical-rich personal care essentials.</p>
            </div>
            <div class="category-card">
                <span class="category-eyebrow">Healthy Water</span>
                <div class="category-label">Promote health through hydration</div>
                <p class="category-desc">Mineralize and refresh with structured water solutions for the whole family.</p>
            </div>
            <div class="category-card">
                <span class="category-eyebrow">Healthy Plants</span>
                <div class="category-label">Organic foliar fertilizer</div>
                <p class="category-desc">Grow thriving gardens with plant nutrition aligned to Dynapharm standards.</p>
            </div>
        </div>
    </section>

    <!-- Features Showcase Section -->
    <section class="features-section">
        <div class="section-header-modern">
            <h2 id="featuresTitle">Why Choose Dynapharm?</h2>
            <p id="featuresSubtitle">Comprehensive health solutions tailored to your needs</p>
        </div>
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">ü©∫</div>
                <h3 id="feature1Title">Expert Consultations</h3>
                <p id="feature1Desc">Book appointments with our experienced health consultants for personalized wellness guidance</p>
                <a href="#" class="feature-link" onclick="showDistributorTab('checkup'); return false;">Learn More ‚Üí</a>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üíä</div>
                <h3 id="feature2Title">Premium Products</h3>
                <p id="feature2Desc">Browse our extensive catalog of 85+ health and wellness products from trusted brands</p>
                <a href="#" class="feature-link" onclick="showDistributorTab('shop'); return false;">Shop Now ‚Üí</a>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üìä</div>
                <h3 id="feature3Title">Distributor Program</h3>
                <p id="feature3Desc">Join our network and earn while helping others achieve their wellness goals</p>
                <a href="distributor-portal.html" target="_blank" class="feature-link">Get Started ‚Üí</a>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üè•</div>
                <h3 id="feature4Title">Full Body Check-ups</h3>
                <p id="feature4Desc">Comprehensive health assessments available at all our branch locations</p>
                <a href="#" class="feature-link" onclick="showDistributorTab('checkup'); return false;">Book Now ‚Üí</a>
            </div>
        </div>
    </section>
    
    <!-- Portal Tabs -->
    <div id="portalTabs" style="display: none; max-width: 1200px; margin: 0 auto; padding: 0 20px; background: var(--white); border-bottom: 2px solid var(--brand-color);">
        <div style="display: flex; gap: 10px; flex-wrap: wrap; padding: 10px 0;">
            <button class="tab-button active" onclick="openTab('client', event)" style="background: var(--brand-color); color: white; padding: 12px 20px; border: none; border-radius: 8px 8px 0 0; cursor: pointer; font-weight: 600;">Distributor / Guest</button>
            <button class="tab-button" onclick="openTab('frontdesk', event)" style="background: transparent; color: var(--text-dark); padding: 12px 20px; border: none; cursor: pointer; font-weight: 600;">Front Desk Portal</button>
            <button class="tab-button" onclick="openTab('consultant', event)" style="background: transparent; color: var(--text-dark); padding: 12px 20px; border: none; cursor: pointer; font-weight: 600;">Consultant Portal</button>
            <button class="tab-button" onclick="openTab('dispenser', event)" style="background: transparent; color: var(--text-dark); padding: 12px 20px; border: none; cursor: pointer; font-weight: 600;">Branch Portal</button>
            <button class="tab-button" onclick="openTab('hr-portal', event)" style="background: transparent; color: var(--text-dark); padding: 12px 20px; border: none; cursor: pointer; font-weight: 600;">HR Portal</button>
            <button class="tab-button" onclick="openTab('finance', event)" style="background: transparent; color: var(--text-dark); padding: 12px 20px; border: none; cursor: pointer; font-weight: 600;">Finance Portal</button>
            <button class="tab-button" onclick="openTab('gm', event)" style="background: transparent; color: var(--text-dark); padding: 12px 20px; border: none; cursor: pointer; font-weight: 600;">GM Portal</button>
            <button class="tab-button" onclick="openTab('director', event)" style="background: transparent; color: var(--text-dark); padding: 12px 20px; border: none; cursor: pointer; font-weight: 600;">Director Portal</button>
            <button class="tab-button" onclick="openTab('mis', event)" style="background: transparent; color: var(--text-dark); padding: 12px 20px; border: none; cursor: pointer; font-weight: 600;">MIS Portal</button>
            <button class="tab-button" onclick="openTab('stock', event)" style="background: transparent; color: var(--text-dark); padding: 12px 20px; border: none; cursor: pointer; font-weight: 600;">Stock Management</button>
            <button class="tab-button" onclick="openTab('admin', event)" style="background: transparent; color: var(--text-dark); padding: 12px 20px; border: none; cursor: pointer; font-weight: 600;">Admin Portal</button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Distributor Portal Sub-tabs (shown when logged in or on Guest Portal) -->
        <div id="distributorSubTabs" style="display: none; max-width: 1200px; margin: 0 auto 20px; padding: 0 20px;">
            <div style="display: flex; gap: 10px; flex-wrap: wrap; border-bottom: 2px solid var(--border);">
                <button class="distributor-tab-btn active" onclick="showDistributorTab('shop')" style="background: var(--brand-color); color: white; padding: 12px 20px; border: none; border-radius: 8px 8px 0 0; cursor: pointer; font-weight: 600;">üõí Shop</button>
                <button class="distributor-tab-btn" onclick="showDistributorTab('checkup')" style="background: transparent; color: var(--text-dark); padding: 12px 20px; border: none; cursor: pointer; font-weight: 600;">üè• Full Body Check Up</button>
                <button class="distributor-tab-btn" onclick="showDistributorTab('media')" style="background: transparent; color: var(--text-dark); padding: 12px 20px; border: none; cursor: pointer; font-weight: 600;">üì∞ Media & News</button>
                <button class="distributor-tab-btn" onclick="showDistributorTab('testimonials')" style="background: transparent; color: var(--text-dark); padding: 12px 20px; border: none; cursor: pointer; font-weight: 600;">üí¨ Testimonials</button>
                <button class="distributor-tab-btn" id="landingEditorButton" style="display: none; background: transparent; color: var(--text-dark); padding: 12px 20px; border: none; cursor: pointer; font-weight: 600;" onclick="openLandingEditorFromButton(event)">‚úèÔ∏è Edit Landing Page</button>
                <a href="distributor-portal.html" target="_blank" class="distributor-tab-btn" style="text-decoration: none; display: inline-block; background: var(--brand-color); color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-weight: 600;">üìä Distributor Dashboard</a>
            </div>
        </div>
        
        <!-- Shop Section -->
        <section id="shop-section" class="shop-section">
            <div class="section-header">
                <h2>üõí Our Products</h2>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                <input type="text" id="productSearch" class="search-bar" placeholder="üîç Search products..." oninput="filterProducts()" style="flex: 1; min-width: 250px;">
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button onclick="openCart()" style="background: var(--brand-color); color: white; padding: 12px 20px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; position: relative;">
                        <span>üõí Cart</span>
                        <span id="cartCount" style="background: white; color: var(--brand-color); border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.85rem; font-weight: bold;">0</span>
                    </button>
                </div>
            </div>
            <div id="productsContainer" class="products-grid">
                <div class="loading">
          <div class="spinner"></div>
                    <p>Loading products...</p>
                </div>
            </div>
            
            <!-- Shopping Cart -->
            <div id="shopCartSection" style="display: none; margin-top: 30px; background: var(--white); padding: 25px; border-radius: 12px; border: 2px solid var(--brand-color); box-shadow: 0 4px 12px rgba(196, 30, 58, 0.1);">
                <h3 style="color: var(--brand-color); margin-bottom: 10px; font-size: 1.5rem;">üõí Shopping Cart</h3>
                <div id="shopCartItems"></div>
                <div style="text-align: right; margin-top: 20px; padding-top: 20px; border-top: 2px solid var(--border);">
                    <p style="font-size: 1.5rem; font-weight: bold; color: var(--brand-color); margin-bottom: 15px;">Total: <span id="shopCartTotal">N$ 0.00</span></p>
                    <button class="btn-submit" onclick="checkoutShopOrder()" style="margin-right: 10px;">Proceed to Checkout</button>
                    <button onclick="clearShopCart()" style="background: var(--border); color: var(--text-dark); padding: 12px 24px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">Clear Cart</button>
                </div>
            </div>
        </section>

        <!-- Guest Portal - Consultation Booking Section -->
        <section class="shop-section" style="margin-top: 40px;">
            <div class="section-header">
                <h2>üè• Book a Health Consultation</h2>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 30px; margin-top: 20px;">
                <div class="card" style="background: var(--white); padding: 30px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                    <h3 style="color: var(--brand-color); margin-bottom: 10px; font-size: 1.3rem;">Consultation Request</h3>
                    <p style="color: var(--text-light); margin-bottom: 20px; font-size: 0.95rem;">Provide your details and preferred slot. We will confirm shortly.</p>

                    <div id="consultation-success-box" class="note hidden" style="background: #fffbeb; border: 1px solid #fde68a; color: #92400e; padding: 12px; border-radius: 8px; margin-bottom: 20px; font-size: 0.9rem;">
                        ‚úÖ Your request was submitted. We will reach out to confirm your appointment.
                    </div>

                    <form id="consultation-booking-form" style="display: grid; gap: 15px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div class="form-group">
                                <label>Full name *</label>
                                <input type="text" id="consultFullName" name="fullName" placeholder="e.g. Jane Doe" required style="width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 8px;">
                            </div>
                            <div class="form-group">
                                <label>Preferred branch *</label>
                                <select id="consultBranch" name="branch" required style="width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 8px;">
                                    <option value="" disabled selected>Select branch</option>
                                    <option>Windhoek Main</option>
                                    <option>Oshakati</option>
                                    <option>Walvis Bay</option>
                                    <option>Swakopmund</option>
                                    <option>Rundu</option>
                                </select>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div class="form-group">
                                <label>Phone</label>
                                <input type="tel" id="consultPhone" name="phone" placeholder="e.g. +264 81 234 5678" style="width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 8px;">
                                <div style="font-size: 0.85rem; color: var(--text-light); margin-top: 5px;">Phone or Email is required</div>
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="consultEmail" name="email" placeholder="e.g. jane@example.com" style="width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 8px;">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div class="form-group">
                                <label>Preferred date *</label>
                                <input type="date" id="consultDate" name="date" required style="width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 8px;">
                            </div>
                            <div class="form-group">
                                <label>Preferred time *</label>
                                <input type="time" id="consultTime" name="time" required style="width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 8px;">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div class="form-group">
                                <label>Consultation type</label>
                                <select id="consultType" name="type" style="width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 8px;">
                                    <option>General Wellness</option>
                                    <option>Nutritional Guidance</option>
                                    <option>Product Advisory</option>
                                    <option>Follow-up</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Notes (optional)</label>
                                <input type="text" id="consultNotes" name="notes" placeholder="Reason / symptoms / preferences" style="width: 100%; padding: 12px; border: 2px solid var(--border); border-radius: 8px;">
                            </div>
                        </div>

                        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 10px;">
                            <button type="button" id="reset-consult-form" style="background: var(--border); color: var(--text-dark); padding: 12px 24px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">Clear</button>
                            <button type="submit" class="btn-submit">Request Appointment</button>
                        </div>
                    </form>
                    <div style="font-size: 0.85rem; color: var(--text-light); margin-top: 15px; text-align: center;">
                        By requesting, you consent to be contacted to confirm the booking.
                    </div>
                </div>

                <div class="card" style="background: var(--white); padding: 30px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                    <h3 style="color: var(--brand-color); margin-bottom: 15px; font-size: 1.3rem;">How it works</h3>
                    <ol style="margin: 0; padding-left: 20px; line-height: 2; color: var(--text-dark);">
                        <li><strong>Submit request</strong>: Fill in your details and preferred slot.</li>
                        <li><strong>Confirmation message</strong>: We'll contact you via phone or email.</li>
                        <li><strong>Visit branch</strong>: Arrive 10 minutes early with your ID.</li>
                    </ol>
                    <div style="margin-top: 20px;">
                        <button id="view-consult-appointments" style="background: var(--brand-color); color: white; padding: 12px 24px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; width: 100%;">View my requests</button>
                    </div>
                    <div style="margin-top: 15px; padding: 12px; background: var(--bg-light); border-radius: 8px; font-size: 0.85rem; color: var(--text-light);">
                        Requests are stored on this device. Staff can also assist in-branch.
                    </div>
                </div>
            </div>

            <!-- Appointment List -->
            <section id="consult-list-card" class="shop-section hidden" style="margin-top: 30px;">
                <div class="section-header">
                    <h2>My appointment requests</h2>
                    <span style="background: #eef6ff; color: #0b5aa0; padding: 4px 12px; border-radius: 999px; font-size: 0.85rem; font-weight: 600;">Local only</span>
                </div>
                <div id="consult-appt-list" style="margin-top: 20px;"></div>
            </section>
        </section>

        <!-- Testimonials Section -->
        <section id="distributor-testimonials-tab" class="shop-section" style="display: none; margin-top: 40px;">
            <div class="section-header">
                <h2>üí¨ Testimonials</h2>
            </div>
            <p style="margin-bottom: 20px; color: var(--text-light);">Read what our customers and members say about Dynapharm products and services</p>
            
            <div id="testimonialsContent" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; margin-bottom: 40px;">
                <!-- Testimonials will be loaded here -->
            </div>
            
            <!-- Add Testimonial Form -->
            <div style="background: linear-gradient(135deg, #c41e3a 0%, #8b0000 100%); color: white; padding: 30px; border-radius: 12px;">
                <h3 style="color: white; margin-bottom: 15px;">Share Your Story</h3>
                <p style="margin-bottom: 20px; opacity: 0.9;">Have you experienced positive results with Dynapharm products? Share your testimonial with us!</p>
                <form onsubmit="submitTestimonial(event)">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div class="form-group">
                            <label style="color: white;">Your Name</label>
                            <input type="text" id="testimonialName" placeholder="Your name" style="padding: 10px; width: 100%; border-radius: 5px; border: none;">
                        </div>
                        <div class="form-group">
                            <label style="color: white;">Location</label>
                            <input type="text" id="testimonialLocation" placeholder="City, Country" style="padding: 10px; width: 100%; border-radius: 5px; border: none;">
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label style="color: white;">Your Testimonial</label>
                        <textarea id="testimonialText" rows="4" required placeholder="Share your experience with Dynapharm products..." style="padding: 10px; width: 100%; border-radius: 5px; border: none; font-family: inherit;"></textarea>
                    </div>
                    <div>
                        <button type="submit" style="background: white; color: #c41e3a; padding: 12px 24px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">Submit Testimonial</button>
                    </div>
                </form>
            </div>
        </section>

        <!-- About Us Section -->
        <section id="about-section" class="about-section">
            <h2 style="color: var(--text-dark); margin-bottom: 18px; font-size: clamp(2rem, 4vw, 2.6rem); font-weight: 800;">Dynapharm Namibia</h2>
            <p style="margin-bottom: 24px; line-height: 1.9; color: var(--text-light); max-width: 820px;">
                Rooted in the legacy of Dynapharm International, our Namibian team delivers trusted natural health products, distributor support, and personalised wellness guidance tailored to local families.
            </p>
            <div class="info-panels">
                <div class="info-card">
                    <h3>Contact Info</h3>
                    <ul>
                        <li><strong>Address:</strong> Shop Commercial Building, Independence Avenue</li>
                        <li><strong>Phone:</strong> 061-300877</li>
                        <li><strong>Email:</strong> <a href="mailto:info@dynapharmnamibia.com">info@dynapharmnamibia.com</a></li>
                        <li><strong>Support:</strong> Available 24/7 for distributors and guests</li>
                    </ul>
                </div>
                <div class="info-card">
                    <h3>Recent Posts</h3>
                    <ul>
                        <li>‚ÄúTwo years ago, I was dying‚Ä¶ today I‚Äôm healthy and thriving.‚Äù</li>
                        <li>‚ÄúStage 3 ovarian cancer ‚Äì Dynapharm gave me a fighting chance.‚Äù</li>
                        <li>‚ÄúMy arthritic pain was unbearable‚Ä¶ until Dynapharm.‚Äù</li>
                        <li>‚ÄúFrom a walking medicine box to renewed energy and wellness.‚Äù</li>
                    </ul>
                </div>
                <div class="info-card">
                    <h3>Useful Links</h3>
                    <ul>
                        <li><a href="#" onclick="showSection('shop'); return false;">Home</a></li>
                        <li><a href="#" onclick="showSection('about'); return false;">About Us</a></li>
                        <li><a href="#" onclick="showDistributorTab('shop'); return false;">My Account</a></li>
                        <li><a href="#" onclick="showDistributorTab('shop'); return false;">Shop</a></li>
                        <li><a href="#" onclick="showDistributorTab('media'); return false;">Wishlist & Media</a></li>
                    </ul>
                </div>
            </div>
        </section>

    <!-- Media Section -->
    <section id="media-section" class="about-section">
        <h2 style="color: var(--brand-color); margin-bottom: 20px;">üì∞ Media & News</h2>
        <p style="margin-bottom: 15px; line-height: 1.8;">
            Stay updated with the latest news, health tips, and company updates from Dynapharm Namibia.
        </p>
        <p style="margin-bottom: 15px; line-height: 1.8; color: var(--text-light);">
            For the latest media updates, news, and health tips, please visit our <a href="distributor-guest.html" style="color: var(--brand-color); text-decoration: underline;">Guest Portal</a>.
        </p>
    </section>
</div>

    <footer class="site-footer">
        <div class="footer-inner">
            <div>
                <h4>Dynapharm Namibia</h4>
                <p style="margin: 0; color: var(--text-light); line-height: 1.8;">
                    Empowering communities with natural wellness solutions, guided by the standards of Dynapharm International.
                </p>
            </div>
            <div>
                <h4>Head Office Contact</h4>
                <ul>
                    <li><strong>Address:</strong> Unit 1202, Robinsons-Equitable Tower, Ortigas Center Pasig City</li>
                    <li><strong>Phone:</strong> +63 2 86372618</li>
                    <li><strong>Email:</strong> <a href="mailto:support@dynapharm.net">support@dynapharm.net</a></li>
                </ul>
            </div>
            <div>
                <h4>Namibia Network</h4>
                <ul>
                    <li><strong>Main Branch:</strong> Windhoek</li>
                    <li><strong>Support Line:</strong> 061-300877</li>
                    <li><a href="#" onclick="showDistributorTab('checkup'); return false;">Book a consultation</a></li>
                    <li><a href="distributor-portal.html" target="_blank">Portal access</a></li>
                </ul>
            </div>
            <div>
                <h4>Useful Links</h4>
                <ul>
                    <li><a href="#" onclick="showSection('shop'); return false;">Home</a></li>
                    <li><a href="#" onclick="showDistributorTab('shop'); return false;">Shop Products</a></li>
                    <li><a href="#" onclick="showDistributorTab('testimonials'); return false;">Testimonials</a></li>
                    <li><a href="#" onclick="showSection('about'); return false;">About Dynapharm</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <span>¬© 2025 Dynapharm Namibia. All rights reserved.</span>
            <div class="footer-social">
                <span style="font-weight: 600; color: var(--brand-dark);">Follow Us:</span>
                <a href="#" aria-label="Facebook">FB</a>
                <a href="#" aria-label="Instagram">IG</a>
                <a href="#" aria-label="YouTube">YT</a>
            </div>
        </div>
    </footer>

    <!-- Login/Register Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content auth-modal">
            <button class="modal-close" onclick="closeLoginModal()">&times;</button>

            <div class="auth-header">
                <span class="auth-pill">Dynapharm Portal Network</span>
                <h2>Sign in to Dynapharm</h2>
                <p>Choose how you would like to access the system. One account unlocks every portal.</p>
            </div>

            <div class="modal-tabs">
                <button class="modal-tab active" onclick="switchModalTab('distributor', event)">üßë‚Äçü§ù‚Äçüßë Distributor / Member</button>
                <button class="modal-tab" onclick="switchModalTab('staff', event)">üë©‚Äçüíº Team Login</button>
                <button class="modal-tab" onclick="switchModalTab('admin', event)">üõ°Ô∏è Administrators</button>
            </div>

            <!-- Distributor Login/Register Form -->
            <div id="distributor-form" class="modal-form active">
                <div class="form-group">
                    <label>Search Distributor</label>
                    <input type="text" id="distributorSearch" placeholder="Type name, code or branch" oninput="filterDistributorOptions(this.value)">
                </div>
                <div class="form-group">
                    <label>Select Distributor Account *</label>
                    <select id="distributorSelect" required>
                        <option value="">-- Select your distributor --</option>
                    </select>
                    <div class="error-message" id="distributorError"></div>
                </div>
                <div class="form-group">
                    <label>Date of Birth *</label>
                    <input type="date" id="distributorDOB" required>
                    <div class="error-message" id="distributorDOBError"></div>
                </div>
                <div id="distributorLoginActions">
                    <button class="btn-submit" id="distributorLoginButton" onclick="handleDistributorLogin()">Continue</button>
                    <p class="auth-footnote">
                        New distributors must be registered by a branch manager. Contact your branch for registration.
                    </p>
                </div>

                <div id="distributorPasswordSection" class="auth-card" style="display: none;">
                    <h4 id="distributorPasswordHeading" style="color: var(--brand-color); margin-bottom: 10px;">Enter Password</h4>
                    <p id="distributorPasswordSubtext" style="color: var(--text-light); font-size: 0.9rem; margin-bottom: 15px;">Please enter your distributor portal password.</p>

                    <div id="distributorLoginFields">
                        <div class="form-group">
                            <label>Password *</label>
                            <input type="password" id="distributorPassword" placeholder="Enter your password">
                        </div>
                    </div>

                    <div id="distributorSetupFields" style="display: none;">
                        <div class="form-group">
                            <label>Create Password *</label>
                            <input type="password" id="distributorNewPassword" placeholder="Create a strong password (min 8 characters)">
                        </div>
                        <div class="form-group">
                            <label>Confirm Password *</label>
                            <input type="password" id="distributorConfirmPassword" placeholder="Re-enter password">
                        </div>
                    </div>

                    <div class="error-message" id="distributorPasswordError"></div>
                    <div class="success-message" id="distributorPasswordSuccess" style="display:none;">Password updated successfully. Redirecting you now...</div>

                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 15px;">
                        <button class="btn-submit" id="distributorPasswordSubmit" onclick="submitDistributorPassword()">Continue</button>
                        <button type="button" class="btn-submit" style="background: var(--border); color: var(--text-dark);" onclick="resetDistributorAuthFlow()">Back</button>
                        <button type="button" class="btn-submit" style="background: transparent; color: var(--brand-color);" onclick="showDistributorResetInfo()">Forgot password?</button>
                    </div>
                </div>
            </div>

            <!-- Staff Login Form -->
            <div id="staff-form" class="modal-form">
                <div class="form-group">
                    <label>Username *</label>
                    <input type="text" id="staffUsername" placeholder="Enter your username" required>
                    <div class="error-message" id="staffUsernameError"></div>
                </div>
                <div class="form-group">
                    <label>Password *</label>
                    <input type="password" id="staffPassword" placeholder="Enter your password" required>
                    <div class="error-message" id="staffPasswordError"></div>
                </div>
                <button class="btn-submit" onclick="handleStaffLogin()">Login to System</button>
                <div class="auth-card" style="font-size: 0.85rem;">
                    <strong style="color: var(--brand-color);">Available Portals:</strong>
                    <ul style="margin: 8px 0 0 20px; color: var(--text-light); line-height: 1.6;">
                        <li>üë®‚Äç‚öïÔ∏è Consultant Portal</li>
                        <li>üíä Dispenser Portal</li>
                        <li>üñ•Ô∏è Front Desk Portal</li>
                        <li>üìä MIS Portal</li>
                        <li>üí∞ Finance Portal</li>
                        <li>üè¢ HR Portal</li>
                        <li>üì¶ Stock Management</li>
                        <li>üëë Admin Portal</li>
                        <li>üè¢ GM Portal</li>
                        <li>üëî Director Portal</li>
                    </ul>
                    <p style="margin-top: 10px; color: var(--text-light); font-size: 0.8rem;">
                        Access depends on your role. Contact administrator for access.
                    </p>
                </div>
            </div>

            <!-- Admin Portal Form -->
            <div id="admin-form" class="modal-form">
                <div class="form-group">
                    <label>Admin Username *</label>
                    <input type="text" id="adminUsername" placeholder="Enter admin username" required>
                    <div class="error-message" id="adminUsernameError"></div>
                </div>
                <div class="form-group">
                    <label>Admin Password *</label>
                    <input type="password" id="adminPassword" placeholder="Enter admin password" required>
                    <div class="error-message" id="adminPasswordError"></div>
                </div>
                <button class="btn-submit" onclick="handleAdminLogin()">Login to Admin Portal</button>
                <div class="auth-card warning" style="font-size: 0.85rem;">
                    <strong style="color: #856404;">Account Access</strong>
                    <p style="margin: 8px 0; color: #856404;">
                        Use the credentials issued by the Dynapharm administrator.
                    </p>
                    <p style="margin-top: 10px; color: #856404; font-size: 0.8rem;">
                        ‚ö†Ô∏è If you need help, contact IT support to reset your password.
                    </p>
                </div>
                <div class="auth-card" style="font-size: 0.85rem;">
                    <strong style="color: var(--brand-color);">Admin Portal Features:</strong>
                    <ul style="margin: 8px 0 0 20px; color: var(--text-light); line-height: 1.6;">
                        <li>üë• User Management (Create/Edit/Delete users)</li>
                        <li>üè¢ Branch Management</li>
                        <li>üîê Password Management</li>
                        <li>üìä System Configuration</li>
                        <li>üåê Access to All Portals</li>
                    </ul>
                </div>
            </div>
        </div>

    <!-- Landing Page Editor Modal -->
    <div id="landingPageEditorModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
            <button class="modal-close" onclick="closeLandingPageEditor()">&times;</button>
            <h2 style="color: var(--brand-color); margin-bottom: 20px;">‚úèÔ∏è Edit Landing Page Content</h2>
            
            <form onsubmit="event.preventDefault(); saveLandingPageContent();">
                <div style="margin-bottom: 30px;">
                    <h3 style="color: var(--brand-color); margin-bottom: 15px; border-bottom: 2px solid var(--border); padding-bottom: 10px;">Hero Section</h3>
                    <div class="form-group">
                        <label>Hero Badge Text</label>
                        <input type="text" id="editHeroBadge" placeholder="üè• Trusted Health Partner Since 2010">
                    </div>
                    <div class="form-group">
                        <label>Hero Title Highlight (Gradient Text)</label>
                        <input type="text" id="editHeroTitleHighlight" placeholder="Natural Solutions">
                    </div>
                    <div class="form-group">
                        <label>Hero Subtitle</label>
                        <textarea id="editHeroSubtitle" rows="3" placeholder="Premium health products, expert consultations..."></textarea>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>Stat: Customers</label>
                            <input type="text" id="editStatCustomers" placeholder="10,000+">
                        </div>
                        <div class="form-group">
                            <label>Stat: Products</label>
                            <input type="text" id="editStatProducts" placeholder="85+">
                        </div>
                        <div class="form-group">
                            <label>Stat: Branches</label>
                            <input type="text" id="editStatBranches" placeholder="5+">
                        </div>
                        <div class="form-group">
                            <label>Stat: Support</label>
                            <input type="text" id="editStatSupport" placeholder="24/7">
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 30px;">
                    <h3 style="color: var(--brand-color); margin-bottom: 15px; border-bottom: 2px solid var(--border); padding-bottom: 10px;">Features Section</h3>
                    <div class="form-group">
                        <label>Features Title</label>
                        <input type="text" id="editFeaturesTitle" placeholder="Why Choose Dynapharm?">
                    </div>
                    <div class="form-group">
                        <label>Features Subtitle</label>
                        <input type="text" id="editFeaturesSubtitle" placeholder="Comprehensive health solutions...">
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <h4 style="color: var(--text-dark); margin-bottom: 10px;">Feature 1</h4>
                            <div class="form-group">
                                <label>Title</label>
                                <input type="text" id="editFeature1Title" placeholder="Expert Consultations">
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea id="editFeature1Desc" rows="3" placeholder="Book appointments..."></textarea>
                            </div>
                        </div>
                        <div>
                            <h4 style="color: var(--text-dark); margin-bottom: 10px;">Feature 2</h4>
                            <div class="form-group">
                                <label>Title</label>
                                <input type="text" id="editFeature2Title" placeholder="Premium Products">
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea id="editFeature2Desc" rows="3" placeholder="Browse our extensive catalog..."></textarea>
                            </div>
                        </div>
                        <div>
                            <h4 style="color: var(--text-dark); margin-bottom: 10px;">Feature 3</h4>
                            <div class="form-group">
                                <label>Title</label>
                                <input type="text" id="editFeature3Title" placeholder="Distributor Program">
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea id="editFeature3Desc" rows="3" placeholder="Join our network..."></textarea>
                            </div>
                        </div>
                        <div>
                            <h4 style="color: var(--text-dark); margin-bottom: 10px;">Feature 4</h4>
                            <div class="form-group">
                                <label>Title</label>
                                <input type="text" id="editFeature4Title" placeholder="Full Body Check-ups">
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea id="editFeature4Desc" rows="3" placeholder="Comprehensive health assessments..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 30px;">
                    <button type="button" class="btn-submit" style="background: var(--border); color: var(--text-dark);" onclick="closeLandingPageEditor()">Cancel</button>
                    <button type="submit" class="btn-submit">üíæ Save Changes</button>
                </div>
            </form>
        </div>
    </div>
    </div>

    <div class="toast" id="globalToast" role="status" aria-live="polite"></div>

    <script>
        // Global state
        let allProducts = [];
        let allDistributors = [];
        let filteredDistributors = [];
        let distributorIndex = {};
        let currentDistributorSelection = null;
        let distributorAuthMode = 'login';
        let users = [];

        const DEFAULT_USERS = [
            {
                id: 'USR001',
                username: 'admin',
                password: 'walker33',
                fullName: 'Administrator',
                email: 'admin@dynapharm.com.na',
                phone: '061-300877',
                role: 'admin',
                branch: 'townshop',
                branches: ['townshop']
            },
            {
                id: 'USR1759829667953',
                username: 'moses',
                password: 'walker33',
                fullName: 'MOSES MUKISA',
                email: 'mosesmukisa1@gmail.com',
                phone: '0817317160',
                role: 'consultant',
                branch: 'townshop',
                branches: ['townshop', 'khomasdal', 'katima', 'outapi', 'ondangwa', 'okongo', 'okahao', 'nkurenkuru', 'swakopmund', 'hochland-park', 'rundu', 'gobabis', 'walvisbay', 'eenhana', 'otjiwarongo'],
                createdAt: '2025-10-07T09:34:27.953Z'
            },
            {
                id: 'USR1759829814781',
                username: 'Geneva',
                password: 'Pearl_11',
                fullName: 'Jennifer Joseph',
                email: 'shange1124@gmail.com',
                phone: '0852803618',
                role: 'consultant',
                branch: 'townshop',
                branches: ['townshop', 'khomasdal', 'katima', 'outapi', 'ondangwa', 'okongo', 'okahao', 'nkurenkuru', 'swakopmund', 'hochland-park', 'rundu', 'gobabis', 'walvisbay', 'eenhana', 'otjiwarongo'],
                createdAt: '2025-10-07T09:36:54.781Z'
            },
            {
                id: 'USR1759830625722',
                username: 'NAEM',
                password: 'PASSWORD',
                fullName: 'NAEM HANGULA',
                email: 'naemhangula4@gmail.com',
                phone: '0817499757',
                role: 'dispenser',
                branch: 'townshop',
                branches: ['townshop'],
                createdAt: '2025-10-07T09:50:25.722Z'
            },
            {
                id: 'USR1759928153488',
                username: 'GEINGOS',
                password: 'ALBERTO99',
                fullName: 'HILMA C',
                email: 'geingoshilma@gmail',
                phone: '0814137106',
                role: 'consultant',
                branch: 'townshop',
                branches: ['townshop', 'khomasdal', 'katima', 'outapi', 'ondangwa', 'okongo', 'okahao', 'nkurenkuru', 'swakopmund', 'hochland-park', 'rundu', 'gobabis', 'walvisbay', 'eenhana', 'otjiwarongo'],
                createdAt: '2025-10-08T12:55:53.488Z'
            }
        ];

        function ensureDefaultUsersSeeded() {
            try {
                const existingRaw = localStorage.getItem('dyna_users');

                if (!existingRaw) {
                    localStorage.setItem('dyna_users', JSON.stringify(DEFAULT_USERS));
                    console.info('Seeded default Dynapharm users (fresh browser).');
                    return;
                }

                let parsed;
                try {
                    parsed = JSON.parse(existingRaw);
                } catch (parseError) {
                    console.warn('Failed to parse stored Dynapharm users, reseeding defaults.', parseError);
                    localStorage.setItem('dyna_users', JSON.stringify(DEFAULT_USERS));
                    return;
                }

                if (!Array.isArray(parsed)) {
                    console.warn('Invalid Dynapharm users structure detected, reseeding defaults.');
                    localStorage.setItem('dyna_users', JSON.stringify(DEFAULT_USERS));
                    return;
                }

                const existingUsernames = new Set(parsed.map(user => (user.username || '').toLowerCase()));
                let updated = false;

                DEFAULT_USERS.forEach(defaultUser => {
                    if (!existingUsernames.has(defaultUser.username.toLowerCase())) {
                        parsed.push(defaultUser);
                        existingUsernames.add(defaultUser.username.toLowerCase());
                        updated = true;
                    }
                });

                if (parsed.length === 0) {
                    localStorage.setItem('dyna_users', JSON.stringify(DEFAULT_USERS));
                    console.info('Seeded default Dynapharm users because none were found.');
                } else if (updated) {
                    localStorage.setItem('dyna_users', JSON.stringify(parsed));
                    console.info('Added missing default Dynapharm users to localStorage.');
                }
            } catch (error) {
                console.error('Error ensuring Dynapharm default users. Attempting to seed defaults.', error);
                try {
                    localStorage.setItem('dyna_users', JSON.stringify(DEFAULT_USERS));
                } catch (storageError) {
                    console.error('Failed to seed default Dynapharm users.', storageError);
                }
            }
        }

        ensureDefaultUsersSeeded();

        let currentAccountUser = null;
        const heroSection = document.querySelector('.hero');
        const heroBadgeEl = document.getElementById('heroBadge');
        const heroTitleHighlightEl = document.getElementById('heroTitleHighlight');
        const heroSubtitleEl = document.getElementById('heroSubtitle');
        const heroPrimaryButton = document.getElementById('heroPrimaryAction');
        const heroSecondaryButton = document.getElementById('heroSecondaryAction');
        const accountNavItem = document.getElementById('accountNavItem');
        const accountInitialsEl = document.getElementById('accountInitials');
        const accountNameEl = document.getElementById('accountName');
        const accountMenu = document.getElementById('accountMenu');
        const accountMenuInitials = document.getElementById('accountMenuInitials');
        const accountMenuName = document.getElementById('accountMenuName');
        const accountMenuRole = document.getElementById('accountMenuRole');
        const accountMenuBranch = document.getElementById('accountMenuBranch');
        const loginNavItem = document.getElementById('loginNavItem');
        const toastEl = document.getElementById('globalToast');

        const HERO_DEFAULTS = {
            badge: 'üè• Trusted Health Partner Since 2010',
            highlight: 'Natural Solutions',
            subtitle: 'Premium health products, expert consultations, and comprehensive wellness services designed to help you live your healthiest life.',
            primaryLabel: 'üõí Shop Products',
            secondaryLabel: 'üè• Book Consultation'
        };

        let toastTimeoutId = null;

        function loadLocalUsers() {
            try {
                const stored = localStorage.getItem('dyna_users');
                if (!stored) {
                    users = [...DEFAULT_USERS];
                    return users;
                }

                const parsed = JSON.parse(stored);
                if (Array.isArray(parsed)) {
                    users = parsed;
                    return parsed;
                }
            } catch (error) {
                console.warn('Failed to parse local Dynapharm users, using defaults.', error);
            }

            users = [...DEFAULT_USERS];
            return users;
        }

        function getInitials(name) {
            if (!name) return 'DN';
            const cleaned = name.trim();
            if (!cleaned) return 'DN';
            const parts = cleaned.split(/\s+/).slice(0, 2);
            return parts.map(part => part.charAt(0).toUpperCase()).join('') || cleaned.charAt(0).toUpperCase();
        }

        function toTitleCase(value) {
            if (!value) return '';
            return value
                .replace(/[-_]+/g, ' ')
                .split(' ')
                .filter(Boolean)
                .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                .join(' ');
        }

        function setHeroAction(button, label, handler) {
            if (!button) return;
            button.textContent = label;
            button.onclick = handler;
        }

        function renderHeroState(user) {
            if (!heroSection || !heroBadgeEl || !heroTitleHighlightEl || !heroSubtitleEl) return;

            if (user) {
                heroSection.setAttribute('data-auth-state', 'signed-in');
                heroBadgeEl.textContent = 'üëã Welcome back';
                heroTitleHighlightEl.textContent = user.fullName || user.username || 'Dynapharm Team';
                const roleLabel = (user.role || '').toLowerCase();
                const friendlyRole = roleLabel ? toTitleCase(roleLabel) : 'team member';
                heroSubtitleEl.textContent = `You‚Äôre signed in as ${friendlyRole}. Jump back into your portal or explore the latest wellness insights.`;
                setHeroAction(heroPrimaryButton, 'üöÄ Enter my portal', () => navigateToRolePortal());
                setHeroAction(heroSecondaryButton, 'üìä View reports', () => {
                    openTab('reports');
                    document.getElementById('portalTabs')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
                });
            } else {
                heroSection.setAttribute('data-auth-state', 'signed-out');
                heroBadgeEl.textContent = HERO_DEFAULTS.badge;
                heroTitleHighlightEl.textContent = HERO_DEFAULTS.highlight;
                heroSubtitleEl.textContent = HERO_DEFAULTS.subtitle;
                setHeroAction(heroPrimaryButton, HERO_DEFAULTS.primaryLabel, () => showDistributorTab('shop'));
                setHeroAction(heroSecondaryButton, HERO_DEFAULTS.secondaryLabel, () => showDistributorTab('checkup'));
            }
        }

        function showToast(message, variant = 'success') {
            if (!toastEl || !message) return;
            toastEl.textContent = message;
            toastEl.classList.remove('success', 'error', 'info');
            toastEl.classList.add(variant);
            toastEl.classList.add('show');

            if (toastTimeoutId) {
                clearTimeout(toastTimeoutId);
            }

            toastTimeoutId = setTimeout(() => {
                toastEl.classList.remove('show');
            }, 3200);
        }

        function closeAccountMenu() {
            accountMenu?.classList.remove('active');
        }

        function toggleAccountMenu(event) {
            event?.preventDefault();
            event?.stopPropagation();
            if (!accountMenu) return;
            if (accountMenu.classList.contains('active')) {
                accountMenu.classList.remove('active');
            } else {
                accountMenu.classList.add('active');
            }
        }

        function navigateToRolePortal() {
            if (!currentAccountUser) {
                openLoginModal();
                return;
            }

            closeAccountMenu();
            const targetUrl = getRoleRedirect((currentAccountUser.role || '').toLowerCase());
            window.location.href = targetUrl;
        }

        function findLocalUserByCredentials(username, password) {
            const localUsers = loadLocalUsers();
            return localUsers.find(user =>
                (user.username || '').toLowerCase() === username.toLowerCase() &&
                (user.password || '') === password
            );
        }

        async function authenticateViaApi(username, password) {
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({ username, password })
                });

                if (response.ok) {
                    const payload = await response.json().catch(() => null);
                    if (payload?.success && payload.user) {
                        return { success: true, user: payload.user };
                    }
                    return { success: false, message: 'Unexpected authentication response.' };
                }

                let message = 'Unable to sign in. Please check your credentials.';
                try {
                    const payload = await response.json();
                    if (payload?.error) {
                        message = payload.error;
                    }
                } catch (parseError) {
                    // ignore JSON parse errors
                }

                const result = { success: false, message, status: response.status };
                if (response.status >= 500) {
                    result.networkError = true;
                }
                return result;
            } catch (error) {
                console.warn('Authentication service unreachable, falling back to local cache.', error);
                return {
                    success: false,
                    message: 'Unable to reach authentication service. Please try again.',
                    networkError: true
                };
            }
        }

        function normalizeUser(user) {
            if (!user) return null;

            const branches = Array.isArray(user.branches)
                ? user.branches
                : typeof user.branches === 'string'
                    ? (() => {
                        try { return JSON.parse(user.branches || '[]'); } catch { return []; }
                    })()
                    : [];

            return {
                id: user.id,
                username: user.username,
                fullName: user.fullName || user.full_name || user.name || user.username,
                email: user.email || null,
                phone: user.phone || null,
                role: user.role || '',
                branch: user.branch || null,
                branches
            };
        }

        function renderAuthState(user) {
            const portalTabs = document.getElementById('portalTabs');
            const distributorSubTabs = document.getElementById('distributorSubTabs');

            currentAccountUser = user;

            if (user) {
                if (loginNavItem) loginNavItem.style.display = 'none';
                if (accountNavItem) accountNavItem.style.display = 'flex';

                const initials = getInitials(user.fullName || user.username);
                if (accountInitialsEl) accountInitialsEl.textContent = initials;
                if (accountNameEl) accountNameEl.textContent = user.fullName || user.username || 'Dynapharm Team';
                if (accountMenuInitials) accountMenuInitials.textContent = initials;
                if (accountMenuName) accountMenuName.textContent = user.fullName || user.username || 'Dynapharm Team';
                if (accountMenuRole) accountMenuRole.textContent = toTitleCase(user.role || 'team member');
                if (accountMenuBranch) accountMenuBranch.textContent = user.branch ? `Primary branch ‚Ä¢ ${toTitleCase(user.branch)}` : '';

                renderHeroState(user);

                if (portalTabs) portalTabs.style.display = 'block';
                if (distributorSubTabs) distributorSubTabs.style.display = 'block';

                const normalizedRole = (user.role || '').toLowerCase();
                toggleLandingEditorButton(normalizedRole === 'admin');
            } else {
                if (loginNavItem) loginNavItem.style.display = 'flex';
                if (accountNavItem) accountNavItem.style.display = 'none';
                closeAccountMenu();
                renderHeroState(null);

                if (portalTabs) portalTabs.style.display = 'none';
                if (distributorSubTabs) distributorSubTabs.style.display = 'none';

                toggleLandingEditorButton(false);
            }
        }

        function getRoleRedirect(role, overridePortal) {
            const normalizedRole = (role || '').toLowerCase();
            const portalMap = {
                admin: 'admin',
                consultant: 'consultant',
                sales_staff: 'consultant',
                dispenser: 'dispenser',
                finance: 'finance',
                finance_manager: 'finance',
                hr: 'hr-portal',
                hr_manager: 'hr-portal',
                hr_admin: 'hr-portal',
                mis: 'mis',
                gm: 'gm',
                general_manager: 'gm',
                director: 'director',
                stock_manager: 'stock',
                warehouse: 'stock',
                stock: 'stock'
            };

            const requestedPortal = (overridePortal || '').toLowerCase();
            const defaultPortal = portalMap[normalizedRole] || 'client';
            const targetPortal = requestedPortal && portalMap[normalizedRole]
                ? requestedPortal
                : (requestedPortal || defaultPortal);

            const url = new URL('dynapharm-complete-system.html', window.location.origin);
            url.searchParams.set('portal', targetPortal);
            return url.pathname + url.search;
        }

        function finalizeUserSession(user, options = {}) {
            const normalized = normalizeUser(user);
            if (!normalized) {
                console.error('Cannot finalize session without valid user.');
                return;
            }

            try {
                localStorage.setItem('currentUser', JSON.stringify(normalized));
            } catch (storageError) {
                console.warn('Unable to persist current user in localStorage.', storageError);
            }

            try {
                localStorage.setItem('currentUserRole', normalized.role || '');
            } catch (storageError) {
                console.warn('Unable to persist current user role.', storageError);
            }
            renderAuthState(normalized);

            if (options.closeModal !== false) {
                closeLoginModal();
            }

            showToast(`Welcome back, ${normalized.fullName || normalized.username}!`, 'success');

            const redirectPortal = new URLSearchParams(window.location.search).get('redirectPortal');
            const redirectUrl = getRoleRedirect(normalized.role, redirectPortal);
            window.location.href = redirectUrl;
        }

        // Section Navigation
        function showSection(section) {
            if (section === 'shop') {
                document.getElementById('shop-section').style.display = 'block';
                document.getElementById('about-section').classList.remove('active');
                document.getElementById('media-section').classList.remove('active');
                loadShopProducts();
            } else if (section === 'about') {
                document.getElementById('shop-section').style.display = 'none';
                document.getElementById('about-section').classList.add('active');
                document.getElementById('media-section').classList.remove('active');
            } else if (section === 'media') {
                document.getElementById('shop-section').style.display = 'none';
                document.getElementById('about-section').classList.remove('active');
                document.getElementById('media-section').classList.add('active');
            }
        }

        // Modal Functions
        function openLoginModal() {
            document.getElementById('loginModal').classList.add('active');
            document.body.classList.add('modal-open');
            closeAccountMenu();
            loadDistributorsForLogin();
        }

        function closeLoginModal() {
            document.getElementById('loginModal').classList.remove('active');
            document.body.classList.remove('modal-open');
            // Reset forms
            document.getElementById('distributorSelect').value = '';
            document.getElementById('distributorDOB').value = '';
            const searchInput = document.getElementById('distributorSearch');
            if (searchInput) searchInput.value = '';
            document.getElementById('staffUsername').value = '';
            document.getElementById('staffPassword').value = '';
            document.getElementById('adminUsername').value = '';
            document.getElementById('adminPassword').value = '';
            // Clear errors
            document.querySelectorAll('.error-message').forEach(el => el.classList.remove('show'));
            resetDistributorAuthFlow(true);
        }

        function switchModalTab(tab, evt) {
            const triggerEvent = evt || window.event;

            document.querySelectorAll('.modal-tab').forEach(btn => btn.classList.remove('active'));
            triggerEvent?.target?.classList?.add('active');
            
            // Update forms
            document.querySelectorAll('.modal-form').forEach(form => form.classList.remove('active'));
            document.getElementById(tab + '-form').classList.add('active');
        }

        // Load distributors for login dropdown
        async function loadDistributorsForLogin(forceRefresh = false) {
            const select = document.getElementById('distributorSelect');
            const searchInput = document.getElementById('distributorSearch');
            if (!select) return;

            if (!forceRefresh && allDistributors.length > 0) {
                if (searchInput) searchInput.value = '';
                filteredDistributors = [...allDistributors];
                renderDistributorOptions(filteredDistributors);
                return;
            }

            select.innerHTML = '<option value="">Loading distributors...</option>';

            let distributors = [];
            let apiError = null;

            try {
                const response = await fetch('/api/distributors?status=active');
                if (!response.ok) {
                    throw new Error(`API responded with ${response.status}`);
                }

                const payload = await response.json();
                distributors = normalizeDistributorPayload(payload);
                localStorage.setItem('dyna_distributors_cache', JSON.stringify({
                    timestamp: Date.now(),
                    data: distributors
                }));
                console.log(`Loaded ${distributors.length} distributors from API`);
            } catch (error) {
                apiError = error;
                console.warn('Distributor API unavailable, using cached data if available', error);

                const cached = localStorage.getItem('dyna_distributors_cache');
                if (cached) {
                    try {
                        const parsed = JSON.parse(cached);
                        if (parsed && Array.isArray(parsed.data)) {
                            distributors = normalizeDistributorPayload(parsed.data);
                            console.log(`Loaded ${distributors.length} distributors from cache`);
                        }
                    } catch (cacheError) {
                        console.error('Error parsing distributor cache', cacheError);
                    }
                }

                if (distributors.length === 0) {
                    const stored = localStorage.getItem('dyna_distributors');
                    if (stored) {
                        try {
                            const parsedStored = JSON.parse(stored);
                            distributors = normalizeDistributorPayload(parsedStored);
                            console.log(`Loaded ${distributors.length} distributors from localStorage fallback`);
                        } catch (storedError) {
                            console.error('Error parsing distributor localStorage fallback', storedError);
                        }
                    }
                }
            }

            allDistributors = distributors;
            filteredDistributors = [...allDistributors];
            buildDistributorIndex(allDistributors);

            if (searchInput) searchInput.value = '';

            if (allDistributors.length === 0) {
                select.innerHTML = apiError
                    ? '<option value="" disabled>Unable to load distributors. Please contact support.</option>'
                    : '<option value="" disabled>No distributors found. Please contact your branch manager for registration.</option>';
                return;
            }

            renderDistributorOptions(filteredDistributors);
        }

        function normalizeDistributorPayload(payload) {
            const list = Array.isArray(payload)
                ? payload
                : Array.isArray(payload?.data)
                    ? payload.data
                    : Array.isArray(payload?.distributors)
                        ? payload.distributors
                        : [];

            return list
                .map(normalizeDistributorRecord)
                .filter(Boolean);
        }

        function normalizeDistributorRecord(raw) {
            if (!raw) return null;

            const code = (raw.distributor_code || raw.distributorCode || raw.code || raw.memberCode || raw.member_code || '')
                .toString()
                .toUpperCase()
                .trim();
            const name = (raw.distributor_name || raw.distributorName || raw.name || raw.fullName || raw.full_name || '').trim();

            if (!code || !name) return null;

            const dobRaw = raw.birthdate || raw.birth_date || raw.dob || raw.dateOfBirth || '';
            const dob = dobRaw ? new Date(dobRaw).toISOString().split('T')[0] : '';

            return {
                id: raw.id || raw._id || raw.distributorId || raw.uuid || code,
                code,
                name,
                branch: raw.branch || raw.branchName || raw.branch_name || raw.location || '',
                dob,
                phone: raw.phone || raw.contact || raw.phoneNumber || raw.contact_number || '',
                email: raw.email || raw.contactEmail || '',
                hasPassword: Boolean(raw.hasPassword ?? raw.passwordSet ?? raw.password_hash ?? raw.passwordHash)
            };
        }

        function buildDistributorIndex(list) {
            distributorIndex = {};
            list.forEach(item => {
                distributorIndex[item.code] = item;
            });
        }

        function renderDistributorOptions(list) {
            const select = document.getElementById('distributorSelect');
            if (!select) return;

            select.innerHTML = '<option value="">-- Select your distributor --</option>';

            const sorted = [...list].sort((a, b) => a.name.localeCompare(b.name));

            sorted.forEach(dist => {
                const option = document.createElement('option');
                option.value = dist.code;
                option.textContent = dist.branch
                    ? `${dist.code} - ${dist.name} (${dist.branch})`
                    : `${dist.code} - ${dist.name}`;
                option.dataset.distributorId = dist.id;
                option.dataset.dob = dist.dob || '';
                option.dataset.hasPassword = dist.hasPassword ? 'true' : 'false';
                option.dataset.branch = dist.branch || '';
                select.appendChild(option);
            });

            if (sorted.length === 0) {
                select.innerHTML = '<option value="" disabled>No distributors match your search.</option>';
            }
        }

        function filterDistributorOptions(searchTerm = '') {
            const term = (searchTerm || '').toLowerCase().trim();
            if (!term) {
                filteredDistributors = [...allDistributors];
            } else {
                filteredDistributors = allDistributors.filter(dist => {
                    return (
                        dist.code.toLowerCase().includes(term) ||
                        dist.name.toLowerCase().includes(term) ||
                        dist.branch.toLowerCase().includes(term)
                    );
                });
            }

            renderDistributorOptions(filteredDistributors);
        }

        function showDistributorPasswordForm(mode = 'login') {
            distributorAuthMode = mode;
            const passwordSection = document.getElementById('distributorPasswordSection');
            const loginActions = document.getElementById('distributorLoginActions');
            const heading = document.getElementById('distributorPasswordHeading');
            const subtext = document.getElementById('distributorPasswordSubtext');
            const loginFields = document.getElementById('distributorLoginFields');
            const setupFields = document.getElementById('distributorSetupFields');
            const errorDiv = document.getElementById('distributorPasswordError');
            const successDiv = document.getElementById('distributorPasswordSuccess');
            const submitButton = document.getElementById('distributorPasswordSubmit');

            if (!passwordSection) return;

            if (loginActions) loginActions.style.display = 'none';
            passwordSection.style.display = 'block';
            if (errorDiv) {
                errorDiv.textContent = '';
                errorDiv.classList.remove('show');
            }
            if (successDiv) successDiv.style.display = 'none';

            const distributorName = currentDistributorSelection?.name || 'Distributor';

            if (mode === 'setup') {
                if (heading) heading.textContent = `Create a Password (${distributorName})`;
                if (subtext) subtext.textContent = 'Create a strong password to access the distributor portal. Minimum 8 characters.';
                if (loginFields) loginFields.style.display = 'none';
                if (setupFields) setupFields.style.display = 'block';
                if (submitButton) submitButton.textContent = 'Save Password & Continue';
            } else {
                if (heading) heading.textContent = `Enter Password (${distributorName})`;
                if (subtext) subtext.textContent = 'Enter your distributor portal password to continue.';
                if (loginFields) loginFields.style.display = 'block';
                if (setupFields) setupFields.style.display = 'none';
                if (submitButton) submitButton.textContent = 'Login';
            }

            const passwordInput = document.getElementById('distributorPassword');
            const newPasswordInput = document.getElementById('distributorNewPassword');
            const confirmPasswordInput = document.getElementById('distributorConfirmPassword');
            if (passwordInput) passwordInput.value = '';
            if (newPasswordInput) newPasswordInput.value = '';
            if (confirmPasswordInput) confirmPasswordInput.value = '';

            if (mode === 'login' && passwordInput) passwordInput.focus();
            if (mode === 'setup' && newPasswordInput) newPasswordInput.focus();
        }

        function resetDistributorAuthFlow(resetSelection = false) {
            const passwordSection = document.getElementById('distributorPasswordSection');
            const loginActions = document.getElementById('distributorLoginActions');
            const passwordInput = document.getElementById('distributorPassword');
            const newPasswordInput = document.getElementById('distributorNewPassword');
            const confirmPasswordInput = document.getElementById('distributorConfirmPassword');
            const errorDiv = document.getElementById('distributorPasswordError');
            const successDiv = document.getElementById('distributorPasswordSuccess');

            if (passwordSection) passwordSection.style.display = 'none';
            if (loginActions) loginActions.style.display = 'block';
            if (passwordInput) passwordInput.value = '';
            if (newPasswordInput) newPasswordInput.value = '';
            if (confirmPasswordInput) confirmPasswordInput.value = '';
            if (errorDiv) {
                errorDiv.textContent = '';
                errorDiv.classList.remove('show');
            }
            if (successDiv) successDiv.style.display = 'none';

            if (resetSelection) {
                currentDistributorSelection = null;
                distributorAuthMode = 'login';
                const select = document.getElementById('distributorSelect');
                if (select) select.selectedIndex = 0;
                const dobInput = document.getElementById('distributorDOB');
                if (dobInput) dobInput.value = '';
            }
        }

        async function submitDistributorPassword() {
            if (!currentDistributorSelection) {
                alert('Please select your distributor account first.');
                resetDistributorAuthFlow(true);
                return;
            }

            const errorDiv = document.getElementById('distributorPasswordError');
            const successDiv = document.getElementById('distributorPasswordSuccess');
            if (errorDiv) {
                errorDiv.textContent = '';
                errorDiv.classList.remove('show');
            }
            if (successDiv) successDiv.style.display = 'none';

            const submitButton = document.getElementById('distributorPasswordSubmit');
            if (submitButton) {
                submitButton.disabled = true;
                submitButton.textContent = distributorAuthMode === 'setup' ? 'Saving...' : 'Signing in...';
            }

            try {
                if (distributorAuthMode === 'setup') {
                    const newPassword = (document.getElementById('distributorNewPassword')?.value || '').trim();
                    const confirmPassword = (document.getElementById('distributorConfirmPassword')?.value || '').trim();

                    if (!newPassword || !confirmPassword) {
                        throw new Error('Please enter and confirm your new password.');
                    }
                    if (newPassword.length < 8) {
                        throw new Error('Password must be at least 8 characters long.');
                    }
                    if (newPassword !== confirmPassword) {
                        throw new Error('Passwords do not match. Please re-enter.');
                    }

                    const response = await fetch(`/api/distributors/${encodeURIComponent(currentDistributorSelection.id)}/set-password`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            password: newPassword,
                            distributorCode: currentDistributorSelection.code
                        })
                    });

                    if (!response.ok) {
                        let message = 'Failed to save password. Please try again.';
                        try {
                            const payload = await response.json();
                            if (payload?.message) message = payload.message;
                        } catch {}
                        throw new Error(message);
                    }

                    if (successDiv) {
                        successDiv.textContent = 'Password created successfully. Logging you in...';
                        successDiv.style.display = 'block';
                    }

                    currentDistributorSelection.hasPassword = true;
                    if (distributorIndex[currentDistributorSelection.code]) {
                        distributorIndex[currentDistributorSelection.code].hasPassword = true;
                    }
                    distributorAuthMode = 'login';
                    setTimeout(() => {
                        completeDistributorLogin(newPassword);
                    }, 1000);
                } else {
                    const password = (document.getElementById('distributorPassword')?.value || '').trim();
                    if (!password) {
                        throw new Error('Please enter your password.');
                    }

                    await completeDistributorLogin(password);
                }
            } catch (error) {
                console.error('Distributor password submission error:', error);
                if (errorDiv) {
                    errorDiv.textContent = error.message || 'Authentication failed. Please try again.';
                    errorDiv.classList.add('show');
                }
            } finally {
                if (submitButton) {
                    submitButton.disabled = false;
                    submitButton.textContent = distributorAuthMode === 'setup' ? 'Save Password & Continue' : 'Login';
                }
            }
        }

        async function completeDistributorLogin(password) {
            const errorDiv = document.getElementById('distributorPasswordError');

            const response = await fetch('/api/distributor-login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    distributorCode: currentDistributorSelection.code,
                    password
                })
            });

            if (!response.ok) {
                let message = 'Invalid credentials. Please try again or contact support.';
                try {
                    const payload = await response.json();
                    if (payload?.message) message = payload.message;
                } catch {}
                throw new Error(message);
            }

            try {
                const session = await response.json();
                localStorage.setItem('dyna_distributor_session', JSON.stringify({
                    distributorCode: currentDistributorSelection.code,
                    distributorId: currentDistributorSelection.id,
                    name: currentDistributorSelection.name,
                    branch: currentDistributorSelection.branch,
                    token: session?.token || null,
                    expiresAt: session?.expiresAt || null
                }));
            } catch (sessionError) {
                console.warn('Could not parse distributor session payload', sessionError);
            }

            closeLoginModal();
            window.location.href = `distributor-portal.html?nb=${encodeURIComponent(currentDistributorSelection.code)}`;
        }

        function showDistributorResetInfo() {
            alert('Please contact your branch administrator or system admin to reset your distributor portal password.');
        }

        // Handle Distributor Login
        async function handleDistributorLogin() {
            const select = document.getElementById('distributorSelect');
            const dobInput = document.getElementById('distributorDOB');
            const errorDiv = document.getElementById('distributorError');
            const dobErrorDiv = document.getElementById('distributorDOBError');
            
            // Clear previous errors
            errorDiv.classList.remove('show');
            dobErrorDiv.classList.remove('show');
            
            const selectedCode = select.value.toUpperCase();
            const dob = dobInput.value;
            
            if (!selectedCode) {
                errorDiv.textContent = 'Please select a distributor';
                errorDiv.classList.add('show');
                return;
            }
            
            if (!dob) {
                dobErrorDiv.textContent = 'Please enter your date of birth';
                dobErrorDiv.classList.add('show');
                return;
            }
            
            const selectedDistributor = distributorIndex[selectedCode];
            if (!selectedDistributor) {
                errorDiv.textContent = 'Distributor not found. Please refresh and try again.';
                errorDiv.classList.add('show');
                return;
            }

            if (selectedDistributor.dob) {
                if (dob !== selectedDistributor.dob) {
                    dobErrorDiv.textContent = 'Date of birth does not match our records. Please double-check and try again.';
                    dobErrorDiv.classList.add('show');
                    return;
                }
            }

            currentDistributorSelection = selectedDistributor;

            const hasPassword = Boolean(selectedDistributor.hasPassword);
            showDistributorPasswordForm(hasPassword ? 'login' : 'setup');
        }

        // Handle Staff Login
        async function handleStaffLogin() {
            const username = document.getElementById('staffUsername').value.trim();
            const password = document.getElementById('staffPassword').value;
            const errorDiv = document.getElementById('staffPasswordError');
            
            // Clear previous errors
            errorDiv.classList.remove('show');
            
            if (!username || !password) {
                errorDiv.textContent = 'Please enter both username and password';
                errorDiv.classList.add('show');
                return;
            }
            
            const apiResult = await authenticateViaApi(username, password);

            if (apiResult.success && apiResult.user) {
                finalizeUserSession(apiResult.user);
                return;
            }

            if (!apiResult.networkError) {
                errorDiv.textContent = apiResult.message || 'Invalid username or password. Please check your credentials or contact your administrator.';
                errorDiv.classList.add('show');
                return;
            }

            const fallbackUser = findLocalUserByCredentials(username, password);

            if (!fallbackUser) {
                errorDiv.textContent = apiResult.message || 'Unable to reach authentication service. Please try again.';
                errorDiv.classList.add('show');
                return;
            }

            if ((fallbackUser.role || '').toLowerCase().includes('distributor')) {
                errorDiv.textContent = 'Distributors should use the Distributor login option.';
                errorDiv.classList.add('show');
                return;
            }

            console.info('Logged in using offline credential cache.');
            finalizeUserSession(fallbackUser);
        }

        // Handle Admin Login
        async function handleAdminLogin() {
            const username = document.getElementById('adminUsername').value.trim();
            const password = document.getElementById('adminPassword').value;
            const errorDiv = document.getElementById('adminPasswordError');
            
            // Clear previous errors
            errorDiv.classList.remove('show');
            
            if (!username || !password) {
                errorDiv.textContent = 'Please enter both username and password';
                errorDiv.classList.add('show');
                return;
            }
            
            const apiResult = await authenticateViaApi(username, password);

            if (apiResult.success && apiResult.user) {
                if ((apiResult.user.role || '').toLowerCase() !== 'admin') {
                    errorDiv.textContent = 'This account does not have administrator access.';
                    errorDiv.classList.add('show');
                    return;
                }

                finalizeUserSession(apiResult.user);
                return;
            }

            if (!apiResult.networkError) {
                errorDiv.textContent = apiResult.message || 'Invalid admin credentials. Please check your username and password.';
                errorDiv.classList.add('show');
                return;
            }

            const fallbackUser = findLocalUserByCredentials(username, password);

            if (!fallbackUser || (fallbackUser.role || '').toLowerCase() !== 'admin') {
                errorDiv.textContent = apiResult.message || 'Unable to reach authentication service. Please try again.';
                errorDiv.classList.add('show');
                return;
            }

            console.info('Admin logged in using offline credential cache.');
            finalizeUserSession(fallbackUser);
        }

        // Load Shop Products
        async function loadShopProducts() {
            const container = document.getElementById('productsContainer');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading products...</p></div>';
            
            try {
                let products = [];
                
                // Method 1: Try API endpoint
                try {
                    const response = await fetch('/api/products');
                    if (response.ok) {
                        const apiProducts = await response.json();
                        if (Array.isArray(apiProducts) && apiProducts.length > 0) {
                            products = apiProducts.map(p => ({
                                description: p.name || p.description || p.product_name,
                                name: p.name || p.description || p.product_name,
                                dp: p.dp || p.distributor_price || p.price,
                                cp: p.cp || p.customer_price,
                                bv: p.bv || p.business_volume,
                                image: p.image || p.image_url || p.photo
                            }));
                        }
                    }
                } catch (e) {
                    console.debug('API not available, trying localStorage');
                }
                
                // Method 2: Try localStorage (set by main system)
                if (products.length === 0) {
                    try {
                        const priceList = JSON.parse(localStorage.getItem('dyna_price_list') || '[]');
                        if (priceList.length > 0) {
                            products = priceList;
                        }
                    } catch (e) {
                        console.debug('localStorage price list not available');
                    }
                }
                
                // Method 3: Try loading from main system window.PRICE_LIST
                if (products.length === 0) {
                    try {
                        // Check if we can access the main system
                        if (window.opener && window.opener.PRICE_LIST) {
                            products = window.opener.PRICE_LIST;
                        } else if (window.parent !== window && window.parent.PRICE_LIST) {
                            products = window.parent.PRICE_LIST;
                        }
                    } catch (e) {
                        console.debug('Cannot access parent window');
                    }
                }
                
                // Method 4: Try to load product images from database
                if (products.length > 0) {
                    try {
                        const imagesResponse = await fetch('/api/product_images');
                        if (imagesResponse.ok) {
                            const images = await imagesResponse.json();
                            const imageMap = new Map();
                            images.forEach(img => {
                                const productName = (img.product_name || '').toLowerCase();
                                if (!imageMap.has(productName) || img.is_primary) {
                                    imageMap.set(productName, img.image_data || img.image_url);
                                }
                            });
                            
                            // Attach images to products
                            products = products.map(p => {
                                const productName = (p.description || p.name || '').toLowerCase();
                                const image = imageMap.get(productName);
                                return { ...p, image: image || p.image || p.photo };
                            });
                        }
                    } catch (e) {
                        console.debug('Could not load product images');
                    }
                }
                
                // Display products
                if (products.length > 0) {
                    allProducts = products;
                    displayProducts(products);
                } else {
                    container.innerHTML = '<div class="loading"><p>No products available at the moment. Please check back later.</p></div>';
                }
            } catch (error) {
                console.error('Error loading products:', error);
                container.innerHTML = '<div class="loading"><p>Error loading products. Please refresh the page.</p></div>';
            }
        }

        // Shopping cart
        let shopCart = [];
        let shopCustomerTypeSelected = false;
        let pendingCartItem = null;

        function displayProducts(products) {
            const container = document.getElementById('productsContainer');
            if (products.length === 0) {
                container.innerHTML = '<div class="loading"><p>No products found.</p></div>';
                return;
            }
            
            container.innerHTML = products.map(product => {
                const name = product.description || product.name || 'Product';
                const cp = product.cp || product.price || 0;
                const dp = product.dp || product.cp || product.price || 0;
                const bv = product.bv || 0;
                const image = product.image || product.photo || '';
                const displayPrice = shopCustomerTypeSelected && shopCart.length > 0 && shopCart[0].customerType === 'distributor' ? dp : cp;
                
                return `
                    <div class="product-card">
                        <img src="${image || 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'250\' height=\'200\'%3E%3Crect fill=\'%23f6f8fb\' width=\'250\' height=\'200\'/%3E%3Ctext x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' dy=\'.3em\' fill=\'%2364748b\' font-family=\'sans-serif\' font-size=\'14\'%3ENo Image%3C/text%3E%3C/svg%3E'}" 
                             alt="${name}" 
                             class="product-image"
                             onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'250\' height=\'200\'%3E%3Crect fill=\'%23f6f8fb\' width=\'250\' height=\'200\'/%3E%3Ctext x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' dy=\'.3em\' fill=\'%2364748b\' font-family=\'sans-serif\' font-size=\'14\'%3ENo Image%3C/text%3E%3C/svg%3E'">
                        <div class="product-info">
                            <div class="product-name">${name}</div>
                            <div class="product-price">N$ ${parseFloat(displayPrice).toFixed(2)}</div>
                            <button onclick="addToShopCart('${name.replace(/'/g, "\\'")}', ${cp}, ${dp}, ${bv})" 
                                    style="width: 100%; margin-top: 10px; background: var(--brand-color); color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; font-weight: bold;">
                                ‚ûï Add to Cart
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function addToShopCart(productName, cp, dp, bv) {
            pendingCartItem = { productName, cp, dp, bv };
            
            if (shopCart.length === 0) {
                showCustomerTypeModal();
                return;
            }
            
            const firstItemCustomerType = shopCart[0].customerType;
            if (firstItemCustomerType) {
                addToCartWithCustomerType(productName, cp, dp, bv, firstItemCustomerType);
            } else {
                showCustomerTypeModal();
            }
        }

        function showCustomerTypeModal() {
            const modal = document.getElementById('customerTypeModal') || createCustomerTypeModal();
            modal.style.display = 'flex';
        }

        function createCustomerTypeModal() {
            const modal = document.createElement('div');
            modal.id = 'customerTypeModal';
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 500px;">
                    <span class="modal-close" onclick="closeCustomerTypeModal()">&times;</span>
                    <h2 style="color: var(--brand-color); margin-bottom: 20px;">Select Customer Type</h2>
                    <p style="margin-bottom: 20px; color: var(--text-light);">Please select your customer type to continue shopping.</p>
                    <div class="form-group">
                        <label>Customer Type</label>
                        <select id="modalCustomerType" style="padding: 12px; width: 100%; font-size: 1rem; border: 2px solid var(--border); border-radius: 8px;">
                            <option value="customer">Customer (CP Pricing)</option>
                            <option value="distributor">Distributor (DP Pricing)</option>
                        </select>
                    </div>
                    <div style="margin-top: 20px;">
                        <button class="btn-submit" onclick="confirmCustomerTypeSelection()">Confirm</button>
                        <button class="btn" onclick="closeCustomerTypeModal()" style="background: var(--border); margin-top: 10px;">Cancel</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            return modal;
        }

        function closeCustomerTypeModal() {
            const modal = document.getElementById('customerTypeModal');
            if (modal) modal.style.display = 'none';
            pendingCartItem = null;
        }

        function confirmCustomerTypeSelection() {
            const customerType = document.getElementById('modalCustomerType')?.value;
            if (!customerType || !pendingCartItem) {
                alert('Please select a customer type.');
                return;
            }
            
            shopCustomerTypeSelected = true;
            addToCartWithCustomerType(
                pendingCartItem.productName,
                pendingCartItem.cp,
                pendingCartItem.dp,
                pendingCartItem.bv,
                customerType
            );
            
            closeCustomerTypeModal();
            displayProducts(allProducts); // Refresh to show correct prices
        }

        function addToCartWithCustomerType(productName, cp, dp, bv, customerType) {
            const price = customerType === 'distributor' ? dp : cp;
            
            const existingItem = shopCart.find(item => item.name === productName && item.customerType === customerType);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                shopCart.push({
                    name: productName,
                    price: price,
                    cp: cp,
                    dp: dp,
                    bv: bv,
                    quantity: 1,
                    customerType: customerType
                });
            }
            
            updateShopCart();
        }

        function updateShopCart() {
            const cartSection = document.getElementById('shopCartSection');
            const cartItems = document.getElementById('shopCartItems');
            const cartTotal = document.getElementById('shopCartTotal');
            const cartCount = document.getElementById('cartCount');
            
            if (!cartSection || !cartItems || !cartTotal) return;
            
            if (shopCart.length === 0) {
                cartSection.style.display = 'none';
                shopCustomerTypeSelected = false;
                if (cartCount) cartCount.textContent = '0';
                return;
            }
            
            cartSection.style.display = 'block';
            
            const customerType = shopCart[0]?.customerType;
            const typeLabel = customerType === 'distributor' ? 'Distributor (DP Pricing)' : 'Customer (CP Pricing)';
            
            cartItems.innerHTML = `
                <p style="color: var(--text-light); margin-bottom: 15px;">Customer Type: <strong>${typeLabel}</strong></p>
                ${shopCart.map((item, index) => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid var(--border); background: var(--bg-light); border-radius: 8px; margin-bottom: 10px;">
                        <div style="flex: 1;">
                            <strong>${item.name}</strong>
                            <p style="color: var(--text-light); font-size: 0.9rem; margin-top: 5px;">N$${item.price.toFixed(2)} x ${item.quantity}</p>
                        </div>
                        <div style="text-align: right;">
                            <p style="font-size: 1.2rem; font-weight: bold; color: var(--brand-color);">N$${(item.price * item.quantity).toFixed(2)}</p>
                            <button onclick="removeFromShopCart(${index})" style="padding: 5px 10px; margin-top: 5px; background: #dc2626; color: white; border: none; border-radius: 5px; cursor: pointer;">Remove</button>
                        </div>
                    </div>
                `).join('')}
            `;
            
            const total = shopCart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            cartTotal.textContent = `N$ ${total.toFixed(2)}`;
            
            const countVal = shopCart.reduce((sum, item) => sum + (item.quantity || 0), 0);
            if (cartCount) cartCount.textContent = String(countVal);
        }

        function removeFromShopCart(index) {
            shopCart.splice(index, 1);
            updateShopCart();
            displayProducts(allProducts);
        }

        function openCart() {
            const cartSection = document.getElementById('shopCartSection');
            if (cartSection && shopCart.length > 0) {
                cartSection.scrollIntoView({ behavior: 'smooth' });
            } else {
                alert('Your cart is empty. Add products to your cart first.');
            }
        }

        function checkoutShopOrder() {
            if (shopCart.length === 0) {
                alert('Your cart is empty.');
                return;
            }
            
            // Show checkout modal with delivery/pickup options
            showCheckoutModal();
        }

        function clearShopCart() {
            if (confirm('Are you sure you want to clear your cart?')) {
                shopCart = [];
                updateShopCart();
                displayProducts(allProducts);
            }
        }

        // Checkout Modal Functions
        let allTowns = [];
        let allBranches = [];
        let selectedDeliveryMethod = 'pickup';
        let selectedTown = null;
        let selectedBranch = null;
        let deliveryFeeData = null;

        async function showCheckoutModal() {
            const modal = document.getElementById('checkoutModal') || createCheckoutModal();
            modal.style.display = 'flex';
            
            // Load towns and branches
            await loadTowns();
            await loadBranches();
            
            // Reset form
            selectedDeliveryMethod = 'pickup';
            selectedTown = null;
            selectedBranch = null;
            deliveryFeeData = null;
            
            // Reset form fields
            const nameInput = document.getElementById('checkoutCustomerName');
            const phoneInput = document.getElementById('checkoutCustomerPhone');
            const emailInput = document.getElementById('checkoutCustomerEmail');
            const addressInput = document.getElementById('checkoutDeliveryAddress');
            const notesInput = document.getElementById('checkoutNotes');
            const branchSelect = document.getElementById('checkoutBranch');
            const townSelect = document.getElementById('checkoutTown');
            
            if (nameInput) nameInput.value = '';
            if (phoneInput) phoneInput.value = '';
            if (emailInput) emailInput.value = '';
            if (addressInput) addressInput.value = '';
            if (notesInput) notesInput.value = '';
            if (branchSelect) branchSelect.value = '';
            if (townSelect) townSelect.value = '';
            
            // Set default delivery method to pickup
            const pickupRadio = document.querySelector('input[name="deliveryMethod"][value="pickup"]');
            if (pickupRadio) pickupRadio.checked = true;
            
            updateCheckoutForm();
        }

        function createCheckoutModal() {
            const modal = document.createElement('div');
            modal.id = 'checkoutModal';
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 600px; max-height: 90vh; overflow-y: auto;">
                    <span class="modal-close" onclick="closeCheckoutModal()">&times;</span>
                    <h2 style="color: var(--brand-color); margin-bottom: 20px;">Checkout</h2>
                    
                    <!-- Order Summary -->
                    <div style="background: var(--bg-light); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <h3 style="margin-bottom: 10px; font-size: 1.1rem;">Order Summary</h3>
                        <div id="checkoutOrderSummary"></div>
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 2px solid var(--border);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>Subtotal:</span>
                                <strong id="checkoutSubtotal">N$ 0.00</strong>
                            </div>
                            <div style="display: none; justify-content: space-between; margin-bottom: 5px;" id="deliveryFeeRow">
                                <span>Delivery Fee:</span>
                                <strong id="checkoutDeliveryFee">N$ 0.00</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 1.2rem; font-weight: bold; color: var(--brand-color); margin-top: 10px; padding-top: 10px; border-top: 2px solid var(--border);">
                                <span>Total:</span>
                                <span id="checkoutTotal">N$ 0.00</span>
                            </div>
                        </div>
                    </div>

                    <!-- Customer Information -->
                    <div class="form-group">
                        <label>Full Name *</label>
                        <input type="text" id="checkoutCustomerName" required placeholder="Enter your full name">
                    </div>
                    <div class="form-group">
                        <label>Phone Number *</label>
                        <input type="tel" id="checkoutCustomerPhone" required placeholder="+264 81 234 5678">
                    </div>
                    <div class="form-group">
                        <label>Email (Optional)</label>
                        <input type="email" id="checkoutCustomerEmail" placeholder="your.email@example.com">
                    </div>

                    <!-- Delivery Method Selection -->
                    <div class="form-group">
                        <label>Delivery Method *</label>
                        <div style="display: flex; gap: 15px; margin-top: 10px;">
                            <label style="display: flex; align-items: center; cursor: pointer; padding: 10px; border: 2px solid var(--border); border-radius: 8px; flex: 1;">
                                <input type="radio" name="deliveryMethod" value="pickup" checked onchange="handleDeliveryMethodChange('pickup')" style="margin-right: 8px;">
                                <span>üìç Branch Pickup (0% fee)</span>
                            </label>
                            <label style="display: flex; align-items: center; cursor: pointer; padding: 10px; border: 2px solid var(--border); border-radius: 8px; flex: 1;">
                                <input type="radio" name="deliveryMethod" value="delivery" onchange="handleDeliveryMethodChange('delivery')" style="margin-right: 8px;">
                                <span>üöö Home Delivery</span>
                            </label>
                        </div>
                    </div>

                    <!-- Branch Selection (for pickup) -->
                    <div class="form-group" id="branchSelectionGroup">
                        <label>Select Branch for Pickup *</label>
                        <select id="checkoutBranch" required onchange="handleBranchChange()">
                            <option value="">-- Select Branch --</option>
                        </select>
                    </div>

                    <!-- Town Selection (for delivery) -->
                    <div class="form-group" id="townSelectionGroup" style="display: none;">
                        <label>Select Town for Delivery *</label>
                        <select id="checkoutTown" onchange="handleTownChange()">
                            <option value="">-- Select Town --</option>
                        </select>
                        <div id="deliveryFeeInfo" style="margin-top: 10px; padding: 10px; background: #eef6ff; border-radius: 8px; display: none;">
                            <small style="color: #0b5aa0;" id="deliveryFeeText"></small>
                        </div>
                    </div>

                    <!-- Delivery Address (for delivery) -->
                    <div class="form-group" id="deliveryAddressGroup" style="display: none;">
                        <label>Delivery Address *</label>
                        <textarea id="checkoutDeliveryAddress" rows="3" placeholder="Enter your full delivery address"></textarea>
                    </div>

                    <!-- Notes -->
                    <div class="form-group">
                        <label>Order Notes (Optional)</label>
                        <textarea id="checkoutNotes" rows="2" placeholder="Any special instructions..."></textarea>
                    </div>

                    <!-- Submit Button -->
                    <button class="btn-submit" onclick="submitOrder()" style="margin-top: 20px;">Place Order</button>
                    <button onclick="closeCheckoutModal()" style="background: var(--border); color: var(--text-dark); padding: 12px 24px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; width: 100%; margin-top: 10px;">Cancel</button>
                </div>
            `;
            document.body.appendChild(modal);
            return modal;
        }

        function closeCheckoutModal() {
            const modal = document.getElementById('checkoutModal');
            if (modal) modal.style.display = 'none';
        }

        async function loadTowns() {
            try {
                const response = await fetch('/api/towns');
                if (response.ok) {
                    allTowns = await response.json();
                } else {
                    // Fallback: use default towns
                    allTowns = [
                        { id: 'town_windhoek', name: 'Windhoek' },
                        { id: 'town_oshakati', name: 'Oshakati' },
                        { id: 'town_ondangwa', name: 'Ondangwa' },
                        { id: 'town_rundu', name: 'Rundu' },
                        { id: 'town_walvis_bay', name: 'Walvis Bay' },
                        { id: 'town_swakopmund', name: 'Swakopmund' },
                        { id: 'town_katima_mulilo', name: 'Katima Mulilo' },
                        { id: 'town_gobabis', name: 'Gobabis' },
                        { id: 'town_otjiwarongo', name: 'Otjiwarongo' },
                    ];
                }
                
                // Populate town dropdown
                const townSelect = document.getElementById('checkoutTown');
                if (townSelect) {
                    townSelect.innerHTML = '<option value="">-- Select Town --</option>';
                    allTowns.forEach(town => {
                        const option = document.createElement('option');
                        option.value = town.id;
                        option.textContent = town.name;
                        townSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading towns:', error);
            }
        }

        async function loadBranches() {
            try {
                const response = await fetch('/api/branches');
                if (response.ok) {
                    allBranches = await response.json();
                } else {
                    // Fallback: use localStorage
                    const stored = localStorage.getItem('dyna_branches');
                    if (stored) {
                        allBranches = JSON.parse(stored);
                    } else {
                        allBranches = [
                            { id: 'townshop', name: 'TOWNSHOP (Head Office)' },
                            { id: 'khomasdal', name: 'KHOMASDAL DPC' },
                            { id: 'katima', name: 'KATIMA DPC' },
                            { id: 'ondangwa', name: 'ONDANGWA DPC' },
                            { id: 'swakopmund', name: 'SWAKOPMUND DPC' },
                            { id: 'rundu', name: 'RUNDU DPC' },
                        ];
                    }
                }
                
                // Populate branch dropdown
                const branchSelect = document.getElementById('checkoutBranch');
                if (branchSelect) {
                    branchSelect.innerHTML = '<option value="">-- Select Branch --</option>';
                    allBranches.forEach(branch => {
                        const option = document.createElement('option');
                        option.value = branch.id;
                        option.textContent = branch.name || branch.branch_name;
                        branchSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading branches:', error);
            }
        }

        function handleDeliveryMethodChange(method) {
            selectedDeliveryMethod = method;
            updateCheckoutForm();
        }

        function handleBranchChange() {
            const branchSelect = document.getElementById('checkoutBranch');
            selectedBranch = branchSelect ? branchSelect.value : null;
            updateCheckoutTotals();
        }

        async function handleTownChange() {
            const townSelect = document.getElementById('checkoutTown');
            selectedTown = townSelect ? townSelect.value : null;
            
            if (selectedTown && selectedDeliveryMethod === 'delivery') {
                await calculateDeliveryFee();
            } else {
                deliveryFeeData = null;
                updateCheckoutTotals();
            }
        }

        async function calculateDeliveryFee() {
            if (!selectedTown || shopCart.length === 0) return;
            
            const subtotal = shopCart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            try {
                const response = await fetch('/api/delivery', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        town_id: selectedTown,
                        branch_id: selectedBranch || null,
                        subtotal: subtotal
                    })
                });
                
                if (response.ok) {
                    deliveryFeeData = await response.json();
                    updateDeliveryFeeDisplay();
                    updateCheckoutTotals();
                } else {
                    // Fallback: use default calculation
                    const distance = 60; // Assume far distance
                    deliveryFeeData = {
                        delivery_fee_percentage: distance >= 50 ? 20.00 : 15.00,
                        delivery_fee: (subtotal * (distance >= 50 ? 20.00 : 15.00)) / 100,
                        distance_km: distance
                    };
                    updateDeliveryFeeDisplay();
                    updateCheckoutTotals();
                }
            } catch (error) {
                console.error('Error calculating delivery fee:', error);
                // Fallback calculation
                const distance = 60;
                deliveryFeeData = {
                    delivery_fee_percentage: 20.00,
                    delivery_fee: (subtotal * 20.00) / 100,
                    distance_km: distance
                };
                updateDeliveryFeeDisplay();
                updateCheckoutTotals();
            }
        }

        function updateDeliveryFeeDisplay() {
            const feeInfo = document.getElementById('deliveryFeeInfo');
            const feeText = document.getElementById('deliveryFeeText');
            
            if (feeInfo && feeText && deliveryFeeData) {
                const distance = deliveryFeeData.distance_km;
                const percentage = deliveryFeeData.delivery_fee_percentage;
                const feeType = distance >= 50 ? 'far' : 'near';
                
                if (distance !== null) {
                    feeText.textContent = `Distance: ${distance}km from nearest branch. Delivery fee: ${percentage}% (${feeType === 'far' ? '50km+' : '<50km'})`;
                } else {
                    feeText.textContent = `Delivery fee: ${percentage}% (estimated)`;
                }
                feeInfo.style.display = 'block';
            }
        }

        function updateCheckoutForm() {
            const branchGroup = document.getElementById('branchSelectionGroup');
            const townGroup = document.getElementById('townSelectionGroup');
            const addressGroup = document.getElementById('deliveryAddressGroup');
            const branchSelect = document.getElementById('checkoutBranch');
            const townSelect = document.getElementById('checkoutTown');
            const addressInput = document.getElementById('checkoutDeliveryAddress');
            
            if (selectedDeliveryMethod === 'pickup') {
                if (branchGroup) branchGroup.style.display = 'block';
                if (townGroup) townGroup.style.display = 'none';
                if (addressGroup) addressGroup.style.display = 'none';
                if (branchSelect) branchSelect.required = true;
                if (townSelect) townSelect.required = false;
                if (addressInput) addressInput.required = false;
                deliveryFeeData = null;
            } else {
                if (branchGroup) branchGroup.style.display = 'none';
                if (townGroup) townGroup.style.display = 'block';
                if (addressGroup) addressGroup.style.display = 'block';
                if (branchSelect) branchSelect.required = false;
                if (townSelect) townSelect.required = true;
                if (addressInput) addressInput.required = true;
                if (selectedTown) {
                    calculateDeliveryFee();
                }
            }
            
            updateCheckoutTotals();
        }

        function updateCheckoutTotals() {
            // Update order summary
            const summaryDiv = document.getElementById('checkoutOrderSummary');
            if (summaryDiv) {
                summaryDiv.innerHTML = shopCart.map(item => `
                    <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border);">
                        <span>${item.name} x ${item.quantity}</span>
                        <strong>N$ ${(item.price * item.quantity).toFixed(2)}</strong>
                    </div>
                `).join('');
            }
            
            // Calculate totals
            const subtotal = shopCart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const deliveryFee = deliveryFeeData ? deliveryFeeData.delivery_fee : 0;
            const total = subtotal + deliveryFee;
            
            // Update display
            const subtotalEl = document.getElementById('checkoutSubtotal');
            const deliveryFeeEl = document.getElementById('checkoutDeliveryFee');
            const deliveryFeeRow = document.getElementById('deliveryFeeRow');
            const totalEl = document.getElementById('checkoutTotal');
            
            if (subtotalEl) subtotalEl.textContent = `N$ ${subtotal.toFixed(2)}`;
            if (deliveryFeeEl) deliveryFeeEl.textContent = `N$ ${deliveryFee.toFixed(2)}`;
            if (deliveryFeeRow) {
                deliveryFeeRow.style.display = selectedDeliveryMethod === 'delivery' && deliveryFee > 0 ? 'flex' : 'none';
            }
            if (totalEl) totalEl.textContent = `N$ ${total.toFixed(2)}`;
        }

        async function submitOrder() {
            // Validate form
            const customerName = document.getElementById('checkoutCustomerName')?.value.trim();
            const customerPhone = document.getElementById('checkoutCustomerPhone')?.value.trim();
            const customerEmail = document.getElementById('checkoutCustomerEmail')?.value.trim();
            const deliveryAddress = document.getElementById('checkoutDeliveryAddress')?.value.trim();
            const notes = document.getElementById('checkoutNotes')?.value.trim();
            
            if (!customerName || !customerPhone) {
                alert('Please fill in your name and phone number.');
                return;
            }
            
            if (selectedDeliveryMethod === 'pickup' && !selectedBranch) {
                alert('Please select a branch for pickup.');
                return;
            }
            
            if (selectedDeliveryMethod === 'delivery') {
                if (!selectedTown) {
                    alert('Please select a town for delivery.');
                    return;
                }
                if (!deliveryAddress) {
                    alert('Please enter your delivery address.');
                    return;
                }
            }
            
            // Prepare order data
            const subtotal = shopCart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const deliveryFee = deliveryFeeData ? deliveryFeeData.delivery_fee : 0;
            const total = subtotal + deliveryFee;
            
            const orderItems = shopCart.map(item => ({
                name: item.name,
                price: item.price,
                quantity: item.quantity,
                customer_type: item.customerType,
                cp: item.cp,
                dp: item.dp,
                bv: item.bv
            }));
            
            const customerType = shopCart[0]?.customerType || 'customer';
            
            const orderData = {
                customer_name: customerName,
                customer_phone: customerPhone,
                customer_email: customerEmail || null,
                customer_type: customerType,
                delivery_method: selectedDeliveryMethod,
                branch_id: selectedDeliveryMethod === 'pickup' ? selectedBranch : null,
                town_id: selectedDeliveryMethod === 'delivery' ? selectedTown : null,
                delivery_address: selectedDeliveryMethod === 'delivery' ? deliveryAddress : null,
                subtotal: subtotal,
                items: orderItems,
                notes: notes || null
            };
            
            // Submit order
            try {
                const response = await fetch('/api/orders', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(orderData)
                });
                
                if (response.ok) {
                    const order = await response.json();
                    
                    // Save to localStorage as fallback
                    try {
                        const existingOrders = JSON.parse(localStorage.getItem('dyna_online_orders') || '[]');
                        existingOrders.push(order);
                        localStorage.setItem('dyna_online_orders', JSON.stringify(existingOrders));
                    } catch (e) {
                        console.error('Error saving to localStorage:', e);
                    }
                    
                    // Show success message
                    alert(`Order placed successfully! Order Number: ${order.order_number}\n\nTotal: N$ ${order.total_amount.toFixed(2)}\n\nWe will contact you shortly to confirm your order.`);
                    
                    // Clear cart
                    shopCart = [];
                    updateShopCart();
                    
                    // Close modal
                    closeCheckoutModal();
                    
                    // Refresh products display
                    displayProducts(allProducts);
                } else {
                    const error = await response.json();
                    alert(`Error placing order: ${error.error || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('Error submitting order:', error);
                
                // Fallback: save to localStorage only
                const orderNumber = `ORD-${Date.now()}-${Math.random().toString(36).substr(2, 6).toUpperCase()}`;
                const fallbackOrder = {
                    id: `order_${Date.now()}`,
                    order_number: orderNumber,
                    ...orderData,
                    delivery_fee: deliveryFee,
                    delivery_fee_percentage: deliveryFeeData ? deliveryFeeData.delivery_fee_percentage : 0,
                    total_amount: total,
                    distance_km: deliveryFeeData ? deliveryFeeData.distance_km : null,
                    status: 'pending',
                    payment_status: 'pending',
                    created_at: new Date().toISOString()
                };
                
                try {
                    const existingOrders = JSON.parse(localStorage.getItem('dyna_online_orders') || '[]');
                    existingOrders.push(fallbackOrder);
                    localStorage.setItem('dyna_online_orders', JSON.stringify(existingOrders));
                    
                    alert(`Order saved locally! Order Number: ${orderNumber}\n\nTotal: N$ ${total.toFixed(2)}\n\nNote: Order saved offline. Please contact us to confirm.`);
                    
                    // Clear cart
                    shopCart = [];
                    updateShopCart();
                    closeCheckoutModal();
                    displayProducts(allProducts);
                } catch (e) {
                    alert('Error saving order. Please try again or contact us directly.');
                }
            }
        }

        function filterProducts() {
            const searchTerm = document.getElementById('productSearch').value.toLowerCase();
            const filtered = allProducts.filter(product => {
                const name = (product.description || product.name || '').toLowerCase();
                return name.includes(searchTerm);
            });
            displayProducts(filtered);
        }

        // Consultation Booking Functionality
        const CONSULT_STORAGE_KEY = 'dyna_consult_appointments';
        
        function loadConsultAppointments() {
            try {
                return JSON.parse(localStorage.getItem(CONSULT_STORAGE_KEY) || '[]');
            } catch(_) {
                return [];
            }
        }
        
        function saveConsultAppointments(list) {
            localStorage.setItem(CONSULT_STORAGE_KEY, JSON.stringify(list));
            try {
                if (window.cloudAutoSaveAll) {
                    window.cloudAutoSaveAll('Cloud sync: new consultation request');
                }
            } catch(_) {}
        }
        
        function renderConsultList() {
            const listWrap = document.getElementById('consult-appt-list');
            if (!listWrap) return;
            
            const appts = loadConsultAppointments();
            const visible = appts.filter(a => a.status !== 'completed');
            
            if (!visible.length) {
                listWrap.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-light);">No upcoming appointments yet.</div>';
                return;
            }
            
            listWrap.innerHTML = visible.map(a => `
                <div style="padding: 15px; border: 1px dashed var(--border); border-radius: 10px; background: var(--bg-light); margin-bottom: 15px;">
                    <div style="display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-wrap: wrap; margin-bottom: 8px;">
                        <div style="font-weight: 700; color: var(--text-dark);">${a.fullName}</div>
                        <span style="background: #eef6ff; color: #0b5aa0; padding: 4px 12px; border-radius: 999px; font-size: 0.85rem; font-weight: 600;">${a.type || 'Consultation'} ‚Ä¢ ${a.branch}</span>
                    </div>
                    <div style="color: var(--text-light); font-size: 0.9rem; margin-top: 6px;">
                        ${a.date} at ${a.time} ‚Ä¢ ${a.phone || a.email || ''}
                    </div>
                    ${a.notes ? `<div style="margin-top: 8px; padding: 8px; background: white; border-radius: 6px; color: var(--text-dark);">${a.notes.replace(/[<>]/g, '')}</div>` : ''}
                </div>
            `).join('');
        }
        
        function handleConsultationSubmit(e) {
            e.preventDefault();
            const form = e.target;
            const data = Object.fromEntries(new FormData(form).entries());
            
            const errs = [];
            if (!data.fullName || data.fullName.trim().length < 2) errs.push('Full name');
            if (!data.phone && !data.email) errs.push('Phone or Email');
            if (!data.date) errs.push('Preferred date');
            if (!data.time) errs.push('Preferred time');
            if (!data.branch) errs.push('Branch');
            
            if (errs.length) {
                alert('Please provide: ' + errs.join(', '));
                return;
            }
            
            const appts = loadConsultAppointments();
            const appt = {
                id: 'appt_' + Date.now(),
                createdAt: new Date().toISOString(),
                status: 'pending',
                fullName: data.fullName.trim(),
                phone: (data.phone || '').trim(),
                email: (data.email || '').trim(),
                date: data.date,
                time: data.time,
                branch: data.branch,
                type: data.type,
                notes: (data.notes || '').trim()
            };
            
            appts.push(appt);
            saveConsultAppointments(appts);
            
            const successBox = document.getElementById('consultation-success-box');
            if (successBox) successBox.classList.remove('hidden');
            
            renderConsultList();
            form.reset();
        }

        // Tab Management Functions
        function openTab(tabName, event) {
            // Redirect to main system for portal access
            if (tabName !== 'client') {
                window.location.href = `dynapharm-complete-system.html#${tabName}`;
                return;
            }
            
            // Show portal tabs and distributor sub-tabs for client/distributor portal
            document.getElementById('portalTabs').style.display = 'block';
            document.getElementById('distributorSubTabs').style.display = 'block';
            showDistributorTab('shop');
            
            // Update active tab button
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.style.background = 'transparent';
                btn.style.color = 'var(--text-dark)';
            });
            if (event && event.target) {
                event.target.style.background = 'var(--brand-color)';
                event.target.style.color = 'white';
            }
        }
        
        function showDistributorTab(tabName) {
            // Hide all distributor tabs
            document.querySelectorAll('[id^="distributor-"]').forEach(el => {
                if (el.classList.contains('shop-section') || el.classList.contains('distributor-subtab')) {
                    el.style.display = 'none';
                }
            });
            
            // Show selected tab
            if (tabName === 'shop') {
                document.getElementById('shop-section').style.display = 'block';
            } else if (tabName === 'testimonials') {
                document.getElementById('distributor-testimonials-tab').style.display = 'block';
                loadTestimonials();
            } else if (tabName === 'checkup') {
                // Show consultation booking section
                document.querySelector('#consult-list-card').parentElement.style.display = 'block';
            } else if (tabName === 'media') {
                document.getElementById('media-section').classList.add('active');
            }
            
            // Update active sub-tab button
            document.querySelectorAll('.distributor-tab-btn').forEach(btn => {
                btn.style.background = 'transparent';
                btn.style.color = 'var(--text-dark)';
            });
            event?.target?.classList?.add('active');
            if (event?.target) {
                event.target.style.background = 'var(--brand-color)';
                event.target.style.color = 'white';
            }
        }

        function toggleLandingEditorButton(visible) {
            const button = document.getElementById('landingEditorButton');
            if (!button) return;
            button.style.display = visible ? 'inline-block' : 'none';
        }

        function openLandingEditorFromButton(event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            openLandingPageEditor();
        }
        
        async function logout() {
            closeAccountMenu();

            try {
                await fetch('/api/auth/logout', {
                    method: 'POST',
                    credentials: 'include'
                });
            } catch (error) {
                console.warn('Logout request failed (continuing with client-side sign-out).', error);
            }

            localStorage.removeItem('currentUser');
            localStorage.removeItem('currentUserRole');

            renderAuthState(null);
            showToast('Signed out successfully.', 'info');
            showSection('shop');
        }
        
        // Testimonials Functions
        function loadTestimonials() {
            const contentDiv = document.getElementById('testimonialsContent');
            if (!contentDiv) return;
            
            try {
                let testimonials = JSON.parse(localStorage.getItem('dyna_testimonials') || '[]');
                
                if (testimonials.length === 0) {
                    const defaultTestimonials = [
                        { id: 'TEST001', name: 'Sarah M.', location: 'Windhoek, Namibia', text: 'Two years ago, I was dying‚Ä¶ today, I am healthy and 6 months pregnant! Dynapharm products have truly transformed my life. I am so grateful for the natural solutions they provide.', date: new Date().toISOString(), approved: true },
                        { id: 'TEST002', name: 'Maria K.', location: 'Ondangwa, Namibia', text: 'I had cancer of the ovaries stage 3‚Ä¶ I have an option to treat it by taking Dynapharm products‚Ä¶ The natural approach combined with my medical treatment has been life-changing. I feel stronger and more hopeful every day.', date: new Date().toISOString(), approved: true },
                        { id: 'TEST003', name: 'John D.', location: 'Swakopmund, Namibia', text: 'My arthritic pain was unbearable‚Ä¶ After using Dynapharm\'s natural relief products for just a few weeks, I noticed a significant improvement. I can now move freely without constant pain.', date: new Date().toISOString(), approved: true },
                        { id: 'TEST004', name: 'Anna T.', location: 'Rundu, Namibia', text: 'I WAS A WALKING MEDICINE BOX, UNTIL DYNAPHARM. Now I take natural supplements and feel better than I have in years. The products are effective and I trust them completely.', date: new Date().toISOString(), approved: true },
                        { id: 'TEST005', name: 'Grace L.', location: 'Katima Mulilo, Namibia', text: 'I HAD BREAST CANCER ‚Ä¶NOW I AM HEALED! Dynapharm products have been an essential part of my healing journey. The support and quality products have given me hope and strength.', date: new Date().toISOString(), approved: true }
                    ];
                    localStorage.setItem('dyna_testimonials', JSON.stringify(defaultTestimonials));
                    displayTestimonials(defaultTestimonials);
                } else {
                    const approved = testimonials.filter(t => t.approved !== false);
                    displayTestimonials(approved);
                }
            } catch (error) {
                console.error('Error loading testimonials:', error);
                contentDiv.innerHTML = '<p style="text-align: center; color: #666; padding: 40px; grid-column: 1/-1;">Error loading testimonials.</p>';
            }
        }
        
        function displayTestimonials(testimonials) {
            const contentDiv = document.getElementById('testimonialsContent');
            if (!contentDiv) return;
            
            if (testimonials.length === 0) {
                contentDiv.innerHTML = '<p style="text-align: center; color: #666; padding: 40px; grid-column: 1/-1;">No testimonials yet. Be the first to share your story!</p>';
                return;
            }
            
            contentDiv.innerHTML = testimonials.sort((a, b) => new Date(b.date || b.createdAt) - new Date(a.date || a.createdAt)).map(testimonial => {
                const date = new Date(testimonial.date || testimonial.createdAt).toLocaleDateString('en-US', { year: 'numeric', month: 'long' });
                return `
                    <div class="testimonial-card-modern">
                        <div class="testimonial-icon-bg">üí¨</div>
                        <div class="testimonial-header-modern">
                            <div class="testimonial-avatar">${testimonial.name.charAt(0).toUpperCase()}</div>
                            <div class="testimonial-info-modern">
                                <h4>${testimonial.name}</h4>
                                <p>${testimonial.location || 'Namibia'}</p>
                            </div>
                        </div>
                        <p class="testimonial-text-modern">
                            "${testimonial.text}"
                        </p>
                        <div class="testimonial-rating-modern">
                            <span>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                            <span class="testimonial-date-modern">${date}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function submitTestimonial(event) {
            event.preventDefault();
            const name = document.getElementById('testimonialName').value.trim();
            const location = document.getElementById('testimonialLocation').value.trim();
            const text = document.getElementById('testimonialText').value.trim();
            
            if (!name || !text) {
                alert('Please fill in your name and testimonial.');
                return;
            }
            
            const testimonials = JSON.parse(localStorage.getItem('dyna_testimonials') || '[]');
            const newTestimonial = {
                id: 'TEST' + Date.now(),
                name: name,
                location: location || 'Namibia',
                text: text,
                date: new Date().toISOString(),
                approved: true
            };
            
            testimonials.push(newTestimonial);
            localStorage.setItem('dyna_testimonials', JSON.stringify(testimonials));
            
            document.getElementById('testimonialName').value = '';
            document.getElementById('testimonialLocation').value = '';
            document.getElementById('testimonialText').value = '';
            
            loadTestimonials();
            alert('Thank you for sharing your story! Your testimonial has been submitted.');
        }

        // Landing Page Content Management
        function loadLandingPageContent() {
            try {
                const content = JSON.parse(localStorage.getItem('landingPageContent') || '{}');
                
                // Hero Section
                if (content.heroBadge) document.getElementById('heroBadge').textContent = content.heroBadge;
                if (content.heroTitleHighlight) document.getElementById('heroTitleHighlight').textContent = content.heroTitleHighlight;
                if (content.heroSubtitle) document.getElementById('heroSubtitle').textContent = content.heroSubtitle;
                if (content.statCustomers) document.getElementById('statCustomers').textContent = content.statCustomers;
                if (content.statProducts) document.getElementById('statProducts').textContent = content.statProducts;
                if (content.statBranches) document.getElementById('statBranches').textContent = content.statBranches;
                if (content.statSupport) document.getElementById('statSupport').textContent = content.statSupport;
                
                // Features Section
                if (content.featuresTitle) document.getElementById('featuresTitle').textContent = content.featuresTitle;
                if (content.featuresSubtitle) document.getElementById('featuresSubtitle').textContent = content.featuresSubtitle;
                if (content.feature1Title) document.getElementById('feature1Title').textContent = content.feature1Title;
                if (content.feature1Desc) document.getElementById('feature1Desc').textContent = content.feature1Desc;
                if (content.feature2Title) document.getElementById('feature2Title').textContent = content.feature2Title;
                if (content.feature2Desc) document.getElementById('feature2Desc').textContent = content.feature2Desc;
                if (content.feature3Title) document.getElementById('feature3Title').textContent = content.feature3Title;
                if (content.feature3Desc) document.getElementById('feature3Desc').textContent = content.feature3Desc;
                if (content.feature4Title) document.getElementById('feature4Title').textContent = content.feature4Title;
                if (content.feature4Desc) document.getElementById('feature4Desc').textContent = content.feature4Desc;
            } catch(e) {
                console.error('Error loading landing page content:', e);
            }
        }

        function saveLandingPageContent() {
            const content = {
                heroBadge: document.getElementById('editHeroBadge').value,
                heroTitleHighlight: document.getElementById('editHeroTitleHighlight').value,
                heroSubtitle: document.getElementById('editHeroSubtitle').value,
                statCustomers: document.getElementById('editStatCustomers').value,
                statProducts: document.getElementById('editStatProducts').value,
                statBranches: document.getElementById('editStatBranches').value,
                statSupport: document.getElementById('editStatSupport').value,
                featuresTitle: document.getElementById('editFeaturesTitle').value,
                featuresSubtitle: document.getElementById('editFeaturesSubtitle').value,
                feature1Title: document.getElementById('editFeature1Title').value,
                feature1Desc: document.getElementById('editFeature1Desc').value,
                feature2Title: document.getElementById('editFeature2Title').value,
                feature2Desc: document.getElementById('editFeature2Desc').value,
                feature3Title: document.getElementById('editFeature3Title').value,
                feature3Desc: document.getElementById('editFeature3Desc').value,
                feature4Title: document.getElementById('editFeature4Title').value,
                feature4Desc: document.getElementById('editFeature4Desc').value
            };
            
            localStorage.setItem('landingPageContent', JSON.stringify(content));
            loadLandingPageContent();
            alert('Landing page content saved successfully!');
        }

        function openLandingPageEditor() {
            const content = JSON.parse(localStorage.getItem('landingPageContent') || '{}');
            
            // Populate form fields
            document.getElementById('editHeroBadge').value = content.heroBadge || 'üè• Trusted Health Partner Since 2010';
            document.getElementById('editHeroTitleHighlight').value = content.heroTitleHighlight || 'Natural Solutions';
            document.getElementById('editHeroSubtitle').value = content.heroSubtitle || 'Premium health products, expert consultations, and comprehensive wellness services designed to help you live your healthiest life.';
            document.getElementById('editStatCustomers').value = content.statCustomers || '10,000+';
            document.getElementById('editStatProducts').value = content.statProducts || '85+';
            document.getElementById('editStatBranches').value = content.statBranches || '5+';
            document.getElementById('editStatSupport').value = content.statSupport || '24/7';
            document.getElementById('editFeaturesTitle').value = content.featuresTitle || 'Why Choose Dynapharm?';
            document.getElementById('editFeaturesSubtitle').value = content.featuresSubtitle || 'Comprehensive health solutions tailored to your needs';
            document.getElementById('editFeature1Title').value = content.feature1Title || 'Expert Consultations';
            document.getElementById('editFeature1Desc').value = content.feature1Desc || 'Book appointments with our experienced health consultants for personalized wellness guidance';
            document.getElementById('editFeature2Title').value = content.feature2Title || 'Premium Products';
            document.getElementById('editFeature2Desc').value = content.feature2Desc || 'Browse our extensive catalog of 85+ health and wellness products from trusted brands';
            document.getElementById('editFeature3Title').value = content.feature3Title || 'Distributor Program';
            document.getElementById('editFeature3Desc').value = content.feature3Desc || 'Join our network and earn while helping others achieve their wellness goals';
            document.getElementById('editFeature4Title').value = content.feature4Title || 'Full Body Check-ups';
            document.getElementById('editFeature4Desc').value = content.feature4Desc || 'Comprehensive health assessments available at all our branch locations';
            
            // Show editor modal
            document.getElementById('landingPageEditorModal').style.display = 'flex';
        }

        function closeLandingPageEditor() {
            document.getElementById('landingPageEditorModal').style.display = 'none';
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            loadShopProducts();
            loadLandingPageContent();
            toggleLandingEditorButton(false);

            const url = new URL(window.location.href);
            const requestedSection = url.searchParams.get('section');
            const requestedTab = url.searchParams.get('tab');
            const requestedModal = url.searchParams.get('modal');
            const hash = window.location.hash;

            const activateDistributorButton = (tabName) => {
                const subTabs = document.getElementById('distributorSubTabs');
                if (!subTabs) return;
                const tabButtons = subTabs.querySelectorAll('button.distributor-tab-btn');
                tabButtons.forEach(btn => {
                    btn.style.background = 'transparent';
                    btn.style.color = 'var(--text-dark)';
                });
                const targetBtn = Array.from(tabButtons).find(btn => {
                    const onClick = btn.getAttribute('onclick') || '';
                    return onClick.includes("'" + tabName + "'");
                });
                if (targetBtn) {
                    targetBtn.style.background = 'var(--brand-color)';
                    targetBtn.style.color = 'white';
                }
            };

            const validSections = ['shop', 'about', 'media'];
            const sectionToActivate = requestedSection && validSections.includes(requestedSection)
                ? requestedSection
                : (hash === '#about-section' ? 'about'
                    : hash === '#media-section' ? 'media'
                    : hash === '#shop-section' ? 'shop'
                    : null);

            if (sectionToActivate) {
                showSection(sectionToActivate);
                const targetId = sectionToActivate === 'shop' ? 'shop-section' : `${sectionToActivate}-section`;
                const targetEl = document.getElementById(targetId);
                if (targetEl) {
                    targetEl.classList.add('active');
                    targetEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }

            const validTabs = ['shop', 'checkup', 'media', 'testimonials'];
            const tabToActivate = requestedTab && validTabs.includes(requestedTab)
                ? requestedTab
                : (hash === '#checkup' ? 'checkup'
                    : hash === '#media' ? 'media'
                    : hash === '#testimonials' ? 'testimonials'
                    : null);

            if (tabToActivate) {
                openTab('client');
                showDistributorTab(tabToActivate);
                document.getElementById('portalTabs')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
                activateDistributorButton(tabToActivate);
            }

            if (requestedModal === 'login' || hash === '#loginModal') {
                openLoginModal();
            }
            
            // Set initial auth state
            const storedUser = localStorage.getItem('currentUser');
            if (storedUser) {
                try {
                    const parsed = JSON.parse(storedUser);
                    renderAuthState(parsed);
                } catch (error) {
                    console.warn('Failed to parse stored user state. Resetting session.', error);
                    renderAuthState(null);
                }
            } else {
                renderAuthState(null);
            }

            document.addEventListener('click', (event) => {
                if (!accountMenu || !accountNavItem) return;
                if (!accountNavItem.contains(event.target)) {
                    closeAccountMenu();
                }
            });

            document.addEventListener('keydown', (event) => {
                if (event.key === 'Escape') {
                    closeAccountMenu();
                    if (document.getElementById('loginModal')?.classList.contains('active')) {
                        closeLoginModal();
                    }
                }
            });
            
            // Consultation booking form
            const consultForm = document.getElementById('consultation-booking-form');
            if (consultForm) {
                consultForm.addEventListener('submit', handleConsultationSubmit);
            }
            
            const resetConsultBtn = document.getElementById('reset-consult-form');
            if (resetConsultBtn) {
                resetConsultBtn.addEventListener('click', function() {
                    if (consultForm) consultForm.reset();
                    const successBox = document.getElementById('consultation-success-box');
                    if (successBox) successBox.classList.add('hidden');
                });
            }
            
            const viewConsultBtn = document.getElementById('view-consult-appointments');
            if (viewConsultBtn) {
                viewConsultBtn.addEventListener('click', function() {
                    const listCard = document.getElementById('consult-list-card');
                    if (listCard) {
                        listCard.classList.remove('hidden');
                        renderConsultList();
                        listCard.scrollIntoView({ behavior: 'smooth' });
                    }
                });
            }
            
            // Close modal on outside click
            document.getElementById('loginModal')?.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeLoginModal();
                }
            });
            
            // Close checkout modal on outside click
            document.getElementById('checkoutModal')?.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeCheckoutModal();
                }
            });
            
            // Allow Enter key to submit forms
            document.getElementById('distributorDOB')?.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') handleDistributorLogin();
            });
            document.getElementById('staffPassword')?.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') handleStaffLogin();
            });
            document.getElementById('adminPassword')?.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') handleAdminLogin();
            });
        });
    </script>
    
    <!-- Load main system script for product data if available -->
    <script>
        // Try to sync with main system's product data
        window.addEventListener('storage', function(e) {
            if (e.key === 'dyna_price_list' || e.key === 'dyna_products') {
                loadShopProducts();
            }
        });
        
        // Register service worker to ensure latest cache version
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('./sw.js', { updateViaCache: 'none' })
                    .then(function(registration) {
                        console.log('ServiceWorker registered:', registration.scope);
                        // Force immediate update check
                        registration.update();
                        
                        // Listen for updates
                        registration.addEventListener('updatefound', function() {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', function() {
                                if (newWorker.state === 'activated') {
                                    // New service worker activated, reload to get fresh content
                                    if (navigator.serviceWorker.controller) {
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch(function(error) {
                        console.log('ServiceWorker registration failed:', error);
                    });
                
                // Check if there's a waiting service worker and prompt reload
                navigator.serviceWorker.addEventListener('controllerchange', function() {
                    window.location.reload();
                });
            });
        }
    </script>
  </body>
</html>
