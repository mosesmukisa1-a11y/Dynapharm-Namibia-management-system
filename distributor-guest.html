<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dynapharm | Distributor Guest - Consultation Booking</title>
    <link rel="icon" href="./favicon.ico">
    <meta name="description" content="Distributor/Guest portal for booking health consultations.">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#1769aa">
    <style>
        :root { --brand:#1769aa; --bg:#f6f8fb; --ink:#1f2a37; --muted:#64748b; --card:#ffffff; --ok:#0f9d58; --warn:#ef6c00; }
        html,body { margin:0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji"; background:var(--bg); color:var(--ink); }
        header { position:sticky; top:0; z-index:10; background:var(--card); border-bottom:1px solid #e5e7eb; }
        .wrap { max-width:960px; margin:0 auto; padding:16px; }
        .brand { display:flex; align-items:center; gap:10px; font-weight:700; color:var(--brand); }
        .logo img { display:block; height:28px; width:auto; }
        .brand .tag { font-weight:600; color:#0b5aa0; background:#e6f0fa; padding:2px 8px; border-radius:999px; font-size:12px; }
        main { padding:24px 16px 64px; }
        .card { background:var(--card); border:1px solid #e5e7eb; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,.04); }
        .grid { display:grid; gap:16px; }
        @media (min-width: 840px){ .grid-2 { grid-template-columns: 1fr 1fr; } }
        h1 { margin:0 0 8px; font-size:22px; }
        p.lead { margin:0; color:var(--muted); }
        form { display:grid; gap:12px; padding:16px; }
        .row { display:grid; gap:12px; }
        @media (min-width:620px){ .row-2 { grid-template-columns: 1fr 1fr; } }
        label { font-size:13px; color:#334155; font-weight:600; }
        input, select, textarea { width:100%; box-sizing:border-box; border-radius:10px; border:1px solid #d1d5db; padding:12px 12px; font-size:14px; background:#fff; color:#111827; }
        textarea { min-height:96px; resize:vertical; }
        .hint { font-size:12px; color:#64748b; }
        .actions { display:flex; gap:10px; align-items:center; justify-content:flex-end; padding:0 16px 16px; }
        .btn { appearance:none; border:none; border-radius:10px; padding:12px 16px; font-weight:700; cursor:pointer; }
        .btn-primary { background:var(--brand); color:#fff; }
        .btn-ghost { background:transparent; color:var(--brand); }
        .pill { display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; background:#eef6ff; color:#0b5aa0; font-size:12px; font-weight:600; }
        .success { color:var(--ok); }
        .danger  { color:#b91c1c; }
        .hidden { display:none !important; }
        .list { padding:8px 16px 16px; }
        .item { padding:12px; border:1px dashed #e5e7eb; border-radius:10px; background:#fafbff; }
        footer { text-align:center; color:#94a3b8; font-size:12px; padding:24px; }
        .note { background:#fffbeb; border:1px solid #fde68a; color:#92400e; padding:10px 12px; border-radius:8px; font-size:13px; }
    </style>
    <script defer src="/cloud-sync.js"></script>
    <script defer src="/auto-cloud-sync.js"></script>
    <script>
        (function(){
            const STORAGE_KEY = 'dyna_consult_appointments';
            function loadAppointments(){
                try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); } catch(_) { return []; }
            }
            function saveAppointments(list){
                localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
                try { if (window.cloudStorage) { /* optional future cloud mapping */ } } catch(_){}
            }

            window.addEventListener('DOMContentLoaded', function(){
                const form = document.getElementById('booking-form');
                const successBox = document.getElementById('success-box');
                const listWrap = document.getElementById('appt-list');
                const viewBtn = document.getElementById('view-appointments');
                const resetBtn = document.getElementById('reset-form');

                function renderList(){
                    const appts = loadAppointments();
                    const visible = appts.filter(a => a.status !== 'completed');
                    if (!visible.length){ listWrap.innerHTML = '<div class="hint">No upcoming appointments yet.</div>'; return; }
                    listWrap.innerHTML = visible.map(a => `
                        <div class="item">
                            <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;">
                                <div style="font-weight:700;">${a.fullName}</div>
                                <div class="pill">${a.type || 'Consultation'} • ${a.branch}</div>
                            </div>
                            <div class="hint" style="margin-top:6px;">${a.date} at ${a.time} • ${a.phone || a.email || ''}</div>
                            ${a.notes ? `<div style="margin-top:6px;">${a.notes.replace(/[<>]/g,'')}</div>` : ''}
                        </div>
                    `).join('');
                }

                form.addEventListener('submit', function(e){
                    e.preventDefault();
                    const data = Object.fromEntries(new FormData(form).entries());
                    const errs = [];
                    if (!data.fullName || data.fullName.trim().length < 2) errs.push('Full name');
                    if (!data.phone && !data.email) errs.push('Phone or Email');
                    if (!data.date) errs.push('Preferred date');
                    if (!data.time) errs.push('Preferred time');
                    if (!data.branch) errs.push('Branch');
                    if (errs.length){ alert('Please provide: ' + errs.join(', ')); return; }

                    const appts = loadAppointments();
                    const appt = {
                        id: 'appt_' + Date.now(),
                        createdAt: new Date().toISOString(),
                        status: 'pending',
                        fullName: data.fullName.trim(),
                        phone: (data.phone||'').trim(),
                        email: (data.email||'').trim(),
                        date: data.date,
                        time: data.time,
                        branch: data.branch,
                        type: data.type,
                        notes: (data.notes||'').trim()
                    };
                    appts.push(appt);
                    saveAppointments(appts);
                    try { if (window.cloudAutoSaveAll) { window.cloudAutoSaveAll('Cloud sync: new consultation request'); } } catch(_){}
                    successBox.classList.remove('hidden');
                    renderList();
                    form.reset();
                });

                viewBtn.addEventListener('click', function(){
                    document.getElementById('list-card').classList.remove('hidden');
                    renderList();
                    window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
                });

                resetBtn.addEventListener('click', function(){ form.reset(); successBox.classList.add('hidden'); });
            });
        })();
    </script>
</head>
<body>
    <header>
        <div class="wrap" style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
            <div class="brand">
                <span class="logo"><img src="./assets/dynapharm-logo.png" alt="Dynapharm Namibia Logo"></span>
                <span style="font-size:18px;">Dynapharm Namibia</span>
                <span class="tag">Distributor / Guest</span>
            </div>
            <nav style="display:flex; gap:8px;">
                <a class="pill" href="/dynapharm-complete-system.html">Back to Main</a>
            </nav>
        </div>
    </header>

    <main>
        <div class="wrap grid grid-2">
            <section class="card" style="padding:16px;">
                <h1>Book a Health Consultation</h1>
                <p class="lead">Provide your details and preferred slot. We will confirm shortly.</p>

                <div id="success-box" class="note hidden" style="margin-top:12px;">
                    ✅ Your request was submitted. We will reach out to confirm your appointment.
                </div>

                <form id="booking-form" autocomplete="on">
                    <div class="row row-2">
                        <div>
                            <label for="fullName">Full name</label>
                            <input id="fullName" name="fullName" type="text" placeholder="e.g. Jane Doe" required>
                        </div>
                        <div>
                            <label for="branch">Preferred branch</label>
                            <select id="branch" name="branch" required>
                                <option value="" disabled selected>Select branch</option>
                                <option>Windhoek Main</option>
                                <option>Oshakati</option>
                                <option>Walvis Bay</option>
                                <option>Swakopmund</option>
                                <option>Rundu</option>
                            </select>
                        </div>
                    </div>

                    <div class="row row-2">
                        <div>
                            <label for="phone">Phone</label>
                            <input id="phone" name="phone" type="tel" inputmode="tel" placeholder="e.g. +264 81 234 5678">
                            <div class="hint">Phone or Email is required.</div>
                        </div>
                        <div>
                            <label for="email">Email</label>
                            <input id="email" name="email" type="email" inputmode="email" placeholder="e.g. jane@example.com">
                        </div>
                    </div>

                    <div class="row row-2">
                        <div>
                            <label for="date">Preferred date</label>
                            <input id="date" name="date" type="date" required>
                        </div>
                        <div>
                            <label for="time">Preferred time</label>
                            <input id="time" name="time" type="time" required>
                        </div>
                    </div>

                    <div class="row row-2">
                        <div>
                            <label for="type">Consultation type</label>
                            <select id="type" name="type">
                                <option>General Wellness</option>
                                <option>Nutritional Guidance</option>
                                <option>Product Advisory</option>
                                <option>Follow-up</option>
                            </select>
                        </div>
                        <div>
                            <label for="notes">Notes (optional)</label>
                            <input id="notes" name="notes" type="text" placeholder="Reason / symptoms / preferences">
                        </div>
                    </div>

                    <div class="actions">
                        <button type="button" id="reset-form" class="btn btn-ghost">Clear</button>
                        <button type="submit" class="btn btn-primary">Request Appointment</button>
                    </div>
                </form>
                <div class="hint">By requesting, you consent to be contacted to confirm the booking.</div>
            </section>

            <aside class="card" style="padding:16px;">
                <h1>How it works</h1>
                <ol style="margin:0; padding-left:18px; line-height:1.8;">
                    <li><b>Submit request</b>: Fill in your details and preferred slot.</li>
                    <li><b>Confirmation message</b>: We’ll contact you via phone or email.</li>
                    <li><b>Visit branch</b>: Arrive 10 minutes early with your ID.</li>
                </ol>
                <div style="margin-top:12px;">
                    <button id="view-appointments" class="btn btn-ghost">View my requests (this device)</button>
                </div>
                <div style="margin-top:12px;" class="hint">Requests are stored on this device. Staff can also assist in-branch.</div>
            </aside>
        </div>

        <section id="list-card" class="wrap card hidden" style="margin-top:16px;">
            <div style="padding:16px 16px 0; display:flex; align-items:center; justify-content:space-between; gap:12px;">
                <h1 style="margin:0;">My appointment requests</h1>
                <span class="pill">Local only</span>
            </div>
            <div id="appt-list" class="list"></div>
        </section>
    </main>

    <footer>
        © <span id="y"></span> Dynapharm Namibia • Distributor/Guest Portal
    </footer>
    <script>
        document.getElementById('y').textContent = new Date().getFullYear();
    </script>
</body>
</html>


